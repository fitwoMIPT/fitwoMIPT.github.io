!function(e,o,t){ps_group=new(function(e,o){function t(){this.ajax={},this.cover={},this.cover.x_position_percent=0,this.cover.y_position_percent=0,this.$cover_ct=jQuery(".js-focus-cover"),this.$cover_image=peepsogroupsdata.group_id?jQuery("img#"+peepsogroupsdata.group_id):jQuery(),this.initial_cover_position=this.$cover_image.attr("style"),o.observer.addFilter("postbox_req",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("show_more_posts",function(e){return+peepsogroupsdata.group_id&&(e.stream_id=peepsogroupsdata.module_id,e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("photos_validate_req",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("photos_upload_req",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("photos_get_list_photos",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("photos_get_list_albums",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("photos_create_album_req",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("photos_add_photos_to_album_req",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("photos_remove_temp_files",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("photos_delete_album",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("photos_delete_stream_album",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("peepso_list_videos",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("tags_get_taggable_params",function(e){return+peepsogroupsdata.group_id&&(e.module_id=peepsogroupsdata.module_id,e.group_id=peepsogroupsdata.group_id),e},10,1),o.observer.addFilter("show_avatar_dialog",function(o){return peepsogroupsdata.id?e.proxy(this.showAvatarDialog,this):o},10,1,this),o.observer.addAction("group_name_updated",function(o,t){var i;+peepsogroupsdata.group_id==+o&&(i=e(".ps-js-group-header")).length&&i.find(".ps-focus-title > span").text(t)},10,2,this),o.observer.addAction("group_privacy_updated",function(o,t){+peepsogroupsdata.group_id==+o&&e(".ps-page--group-edit").length&&window.location.reload()},10,2,this)}return t.prototype.init_page=function(t){t&&(this._header_$el=e(".ps-js-group-header"),this._header_$actions=e(".ps-js-group-header-actions"),this._header_$actions_loadingHtml=this._header_$actions.eq(0).html(),this._header_$actions.html(this._header_$actions_loadingHtml),this._get_data(t).done(function(e){this._data=e,o.observer.applyFilters("group_data",e)}),o.observer.addFilter("group_data",e.proxy(function(e){this._update_header_actions(e)},this),10,1),this._header_$actions.on("click",".ps-js-join",e.proxy(function(o){var i=e(o.currentTarget).find("img").show();this.join(t).done(function(e){i.hide(),window.location.reload()})},this)),this._header_$actions.on("click",".ps-js-leave",e.proxy(function(o){var i=e(o.currentTarget).find("img").show();this.leave(t).done(function(e){i.hide(),window.location.reload()})},this)),this.init()),e(document.body).on("click",".ps-js-group-member-action",e.proxy(function(i){var s=e(i.currentTarget);if(!s.data("ps-loading")){i.preventDefault(),i.stopPropagation();var r=e.extend({},s.data());if(r.method&&(r.id||t)){var a=s.find("img");!a.length&&s.parent().hasClass("ps-js-dropdown-menu")&&(a=(a=s.parent().siblings(".ps-js-dropdown-toggle")).find("img"),s.parent().hide());var n=r.method,p=r.confirm;r.group_id=r.id||t,delete r.method,delete r.confirm,delete r.id,this._member_action_confirmation(p).done(function(){n.indexOf("search_to_invite")>=0?this.invite(t):(s.data("ps-loading",!0),a.show(),this.member_action(n,r).done(function(e){var t,i,a=s.closest(".ps-members-item-wrapper");if(n.indexOf("passive")>=0){if(e.reload)return void window.location.reload();e.hide?(a.remove(),_.isUndefined(e.pending_user_member_count)||o.observer.doAction("pending_user_member_count",+r.group_id,+e.pending_user_member_count),_.isUndefined(e.pending_admin_member_count)||o.observer.doAction("pending_admin_member_count",+r.group_id,+e.pending_admin_member_count)):(_.isUndefined(e.display_role)||a.find(".ps-members-item-role").html(e.display_role),e.member_passive_actions&&e.member_passive_actions.length&&(t=o.template(peepsogroupsdata.memberItemActionsTemplate),i={member_passive_actions:e.member_passive_actions,id:r.group_id,passive_user_id:r.passive_user_id},a.find(".ps-js-dropdown").html(t(i)))),+peepsodata.currentuserid==+r.passive_user_id&&(this._header_$actions.html(this._header_$actions_loadingHtml),this._get_data(r.group_id).done(function(e){this._data=e,o.observer.applyFilters("group_data",e)})),o.observer.doAction("notification_clear_cache")}else n.match(/\.?join$/)?window.location.reload():n.indexOf("leave")>=0?e.member_actions&&e.member_actions.length>1?this._update_header_actions(e):window.location.reload():this._update_header_actions(e)}).fail(function(e){s.removeData("ps-loading"),a.hide(),e&&e.length&&pswindow.show("",e.join("<br/>"))}))})}}},this)),e(document.body).on("click",".ps-js-groups .ps-js-more",e.proxy(function(o){o.preventDefault(),o.stopPropagation();var t=e(o.currentTarget).closest(".ps-js-group-item"),i=t.find(".ps-js-owner"),s=t.find(".ps-js-categories"),r=t.find(".ps-js-category-icon");+peepsogroupsdata.list_show_owner&&(i.data("ps-loaded")||i.data("ps-loading")||(i.data("ps-loading",!0),this.get_owners(i.data("id")).done(function(e){i.data("ps-loaded",!0),i.removeData("ps-loading"),e&&e.length?i.html('<a href="'+e[0].profileurl+'">'+e[0].fullname+"</a>"):i.html("<em>No owner</em>")}))),s.data("ps-loaded")||s.data("ps-loading")||(s.data("ps-loading",!0),this.get_categories(s.data("id")).done(function(e){s.data("ps-loaded",!0),s.removeData("ps-loading"),e&&e.length?(e=_.map(e,function(e){return'<a href="'+e.url+'">'+e.name+"</a>"}),s.html(e.join(", ")),e.length>1&&r.attr("class","ps-icon-tags")):s.html("<em>No category</em>")}))},this)),e(".ps-js-focus .ps-js-privacy .ps-js-dropdown-menu").on("click","[data-option-value]",function(t){var i,s=e(t.currentTarget),r=s.closest(".ps-js-dropdown-menu").siblings(".ps-js-dropdown-toggle"),a=+s.data("optionValue");a!==+peepsogroupsdata.privacy&&(i={privacy:a,group_id:peepsogroupsdata.group_id,_wpnonce:peepsogroupsdata.nonce_set_group_privacy},pswindow.confirm(peepsogroupsdata.lang.privacy_change_confirmation,function(){var e=r.find("img").show();pswindow.hide(),o.getJson("groupajax.set_group_privacy",i,function(t){var s,a=r.find("i"),n=a.siblings("span");e.hide(),t.success?(s=t.data.new_privacy,peepsogroupsdata.privacy=s.id,a.attr("class",s.icon),n.html(s.name),r.addClass("ps-list-info-success"),setTimeout(function(){r.removeClass("ps-list-info-success")},1e3),o.observer.doAction("group_privacy_updated",i.group_id,{id:s.id,icon:s.icon,name:s.name})):t.errors&&psmessage.show("",t.errors[0])})}))}),e(".ps-js-focus-box-toggle").on("click",function(o){var t=e(".ps-js-focus-box"),i=e(document),s="click.ps-focusbox-toggle",r="ps-focus__box--open";o.stopPropagation(),t.hasClass(r)?(t.removeClass(r),i.off(s)):(t.addClass(r),i.one(s,function(){t.removeClass(r)}))})},t.prototype._get_data=function(t){return e.Deferred(e.proxy(function(i){var s={group_id:t,context:"cover",keys:"groupuserajax.member_actions,groupfollowerajax.follower_actions"};o.getJson("groupajax.group",s,e.proxy(function(e){e.success?i.resolveWith(this,[e.data]):i.rejectWith(this,[e.errors])},this))},this))},t.prototype._normalize_header_actions=function(e,o){return _.map(e,function(e){var t=e.label||"",i=t.charAt(0);return i.match(/[a-z]/)&&(t=i.toUpperCase()+t.slice(1)),e.label=t,_.isString(e.action)&&e.action.indexOf(".")<0?e.action=o+"."+e.action:_.isArray(e.action)&&(e.action=this._normalize_header_actions(e.action,o)),e},this)},t.prototype._update_header_actions=function(t){var i,s,r,a=o.template(peepsogroupsdata.headerActionsTemplate);(r=(t=t||{}).group||{}).groupuserajax&&!_.isUndefined(r.groupuserajax.member_actions)?i=r.groupuserajax.member_actions||[]:_.isUndefined(t.member_actions)||(i=t.member_actions||[]),i&&(i=this._normalize_header_actions(i,"groupuserajax")),r.groupfollowerajax&&!_.isUndefined(r.groupfollowerajax.follower_actions)?s=r.groupfollowerajax.follower_actions||[]:_.isUndefined(t.follower_actions)||(s=t.follower_actions||[]),s&&(s=this._normalize_header_actions(s,"groupfollowerajax")),this._header_actions=this._header_actions||{},this._header_actions.member_actions=i||this._header_actions.member_actions,this._header_actions.follower_actions=s||this._header_actions.follower_actions,this._header_$actions.html(a(this._header_actions)),_.defer(e.proxy(function(){var e,o,t=window.location;t.href.match(/#membership/)&&(e=this._header_$actions.find(".ps-js-btn-membership"),o=e.siblings(".ps-js-dropdown-menu").show(),e.add(o).addClass("ps-list-info-success"),setTimeout(function(){e.add(o).removeClass("ps-list-info-success")},1e3),"replaceState"in window.history&&history.replaceState("",document.title,t.pathname+t.search))},this))},t.prototype.get_owners=function(t){return e.Deferred(e.proxy(function(i){var s={group_id:t,role:"owner",keys:"fullname,profileurl"};o.getJson("groupusersajax.search",s,e.proxy(function(e){e.data&&e.data.members?i.resolveWith(this,[e.data.members]):i.rejectWith(this,[e.errors])},this))},this))},t.prototype.get_members=function(t){return e.Deferred(e.proxy(function(i){var s={group_id:t,keys:"avatar,fullname,profileurl,role"};o.getJson("groupusersajax.search",s,e.proxy(function(e){e.data&&e.data.members?i.resolveWith(this,[e.data.members]):i.rejectWith(this,[e.errors])},this))},this))},t.prototype.get_categories=function(t){return e.Deferred(e.proxy(function(i){var s={group_id:t,keys:"name,url"};o.getJson("groupcategoriesgroupsajax.categories_for_group",s,e.proxy(function(e){e.data&&e.data.categories?i.resolveWith(this,[e.data.categories]):i.rejectWith(this,[e.errors])},this))},this))},t.prototype.join=function(t){return e.Deferred(e.proxy(function(i){o.postJson("groupuserajax.join",{group_id:t},e.proxy(function(e){e.success?i.resolveWith(this,[e.data]):i.rejectWith(this,[e.errors])},this))},this))},t.prototype.leave=function(t){return e.Deferred(e.proxy(function(i){o.postJson("groupuserajax.leave",{group_id:t},e.proxy(function(e){e.success?i.resolveWith(this,[e.data]):i.rejectWith(this,[e.errors])},this))},this))},t.prototype.invite=function(e){o.groups.dlgInvite(e)},t.prototype.inviteUser=function(t,i){return e.Deferred(e.proxy(function(s){o.getJson("groupuserajax.passive_invite",{group_id:t,passive_user_id:i},e.proxy(function(e){e.success?s.resolveWith(this,[e.data]):s.rejectWith(this,[e.errors])},this))},this))},t.prototype.edit_name=function(o,t){var i=e(t).closest(".ps-js-group-name"),s=i.find(".ps-js-group-name-text"),r=i.find(".ps-js-group-name-editor"),a=i.find(".ps-js-btn-edit"),n=i.find(".ps-js-btn-cancel"),p=i.find(".ps-js-btn-submit"),d=r.find("input[type=text]"),u=i.find(".ps-js-limit"),c=d.val();r.is(":visible")||(s.hide(),a.hide(),n.show(),p.show(),r.show(),d.focus(),_.defer(function(){d[0].selectionStart=d[0].selectionEnd=c.length}),d.data("original-value")||(d.data("original-value",c),d.off("input keydown").on("input",function(o){var t=e.trim(d.val()),i=e.trim(d.data("original-value")),s=+d.data("maxlength");s&&t.length>s&&(t=t.substr(0,s),d.val(t)),u.html(s-t.length),t&&t!==i?p.removeAttr("disabled"):p.attr("disabled","disabled")}).on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation(),p.attr("disabled")||p.click())})),d.trigger("input"),n.off("click").on("click",function(){d.val(d.data("original-value")),r.hide(),p.hide(),n.hide(),a.show(),s.show()}),p.off("click").on("click",e.proxy(function(){var t=peepsogroupsdata.lang.name_change_confirmation;pswindow.confirm(t,e.proxy(function(){var e=p.find("img").show(),t=d.val();pswindow.hide(),this._updateName(o,t).always(function(){e.hide()}).done(function(){d.data("original-value",t),s.text(t),n.click()}).fail(function(e){psmessage.show("",e)})},this),function(){pswindow.hide(),n.click()})},this)))},t.prototype._updateName=function(t,i){var s="_xhr_"+t,r=this._updateName[s];return r&&r.abort(),e.Deferred(e.proxy(function(r){var a=o.postJson("groupajax.set_group_name",{group_id:t,name:i,_wpnonce:peepsogroupsdata.nonce_set_group_name},e.proxy(function(e){e.success?(o.observer.doAction("group_name_updated",t,i),r.resolve()):e.errors?r.reject(e.errors[0]):r.reject()},this));this._updateName[s]=a.ret},this))},t.prototype.edit_slug=function(o,t){var i,s,r,a=e(t).closest(".ps-js-group-slug"),n=a.find(".ps-js-group-slug-text"),p=a.find(".ps-js-group-slug-editor"),d=a.find(".ps-js-group-slug-trigger");p.is(":visible")||(n.hide(),d.hide(),p.show(),s=p.find(".ps-js-submit"),(i=p.find("input")).data("original-value",r=i.val()),i.focus().val("").val(r),p.off("click input"),p.on("click",".ps-js-cancel",function(){i.val(r),p.off("click").hide(),n.show(),d.show()}),p.on("click",".ps-js-submit",e.proxy(function(e){this.save_slug(o,i.val(),e.currentTarget)},this)),p.on("input","input",function(o){var t=e(o.currentTarget),i=t.closest(".ps-js-group-slug").find(".ps-js-limit"),r=+t.data("maxlength"),a=t.val();r&&a.length>r&&(a=a.substr(0,r),t.val(a)),i.html(r-a.length),e.trim(a)?s.removeAttr("disabled"):s.attr("disabled","disabled")}),i.trigger("input"))},t.prototype.save_slug=function(t,i,s){var r,a="save_slug";this.ajax[a]||(this.ajax[a]=!0,i=e.trim(i),(r=e(s).find(".ps-js-loading")).show(),o.postJson("groupajax.set_group_slug",{group_id:t,slug:i,_wpnonce:peepsogroupsdata.nonce_set_group_slug},e.proxy(function(o){var t=e(s).closest(".ps-js-group-slug"),i=(t.find(".ps-js-group-slug-text"),t.find(".ps-js-group-slug-editor"));t.find(".ps-js-group-slug-trigger"),i.find("input"),this.ajax[a]=!1,r.hide(),o.success?window.location=o.data.redirect:o.errors&&psmessage.show("",o.errors[0])},this)))},t.prototype.save_name=function(t,i,s){var r,a="save_name";this.ajax[a]||(this.ajax[a]=!0,i=e.trim(i),(r=e(s).find(".ps-js-loading")).show(),o.postJson("groupajax.set_group_name",{group_id:t,name:i,_wpnonce:peepsogroupsdata.nonce_set_group_name},e.proxy(function(o){var t=e(s).closest(".ps-js-group-name"),n=t.find(".ps-js-group-name-text"),p=t.find(".ps-js-group-name-editor"),d=t.find(".ps-js-group-name-trigger"),u=p.find("input");this.ajax[a]=!1,r.hide(),o.success?(u.val(i),p.off("click").hide(),n.text(i).show(),d.show(),o.data&&o.data.redirect&&(window.location=o.data.redirect)):o.errors&&psmessage.show("",o.errors[0])},this)))},t.prototype.edit_cats=function(o,t){var i,s=e(t).closest(".ps-js-group-cat"),r=s.find(".ps-js-group-cat-text"),a=s.find(".ps-js-group-cat-editor"),n=s.find(".ps-js-btn-edit");a.is(":visible")||(r.hide(),a.show(),n.hide(),(i=a.find("input[type=checkbox], input[type=radio]")).each(function(){e(this).data("original-value",this.checked)}),a.off("click"),a.on("click",".ps-js-cancel",function(){i.each(function(){this.checked=e(this).data("original-value")}),a.off("click").hide(),r.show(),n.show()}),a.on("click",".ps-js-submit",e.proxy(function(e){var t=i.filter(function(){return this.checked}).map(function(){return+this.value});t=Array.prototype.slice.call(t),this.save_cats(o,t,e.currentTarget)},this)),a.on("click","input[type=checkbox], input[type=radio]",function(o){e(o.currentTarget);var t=a.find(".ps-js-submit");i.filter(function(){return this.checked}).length>=1?t.removeAttr("disabled"):t.attr("disabled","disabled")}))},t.prototype.save_cats=function(t,i,s){var r,a="save_cats";this.ajax[a]||(this.ajax[a]=!0,(r=e(s).find(".ps-js-loading")).show(),o.postJson("groupajax.set_group_categories",{group_id:t,category_id:i,_wpnonce:peepsogroupsdata.nonce_set_group_categories},e.proxy(function(o){var t=e(s).closest(".ps-js-group-cat"),n=t.find(".ps-js-group-cat-text"),p=t.find(".ps-js-group-cat-editor"),d=t.find(".ps-js-btn-edit"),u=p.find("input[type=checkbox], input[type=radio]"),c=[];this.ajax[a]=!1,r.hide(),o.success?(u.each(function(){this.checked=i.indexOf(+this.value)>=0,this.checked&&c.push(['<a href="',peepsogroupsdata.group_url.replace("##category_id##",this.value),'">',e(this).next("label").text(),"</a>"].join(""))}),p.off("click").hide(),n.html(c.join("")).show(),d.show()):o.errors&&psmessage.show("",o.errors[0])},this)))},t.prototype.edit_desc=function(o,t){var i,s,r=e(t).closest(".ps-js-group-desc"),a=r.find(".ps-js-group-desc-text"),n=r.find(".ps-js-group-desc-placeholder"),p=r.find(".ps-js-group-desc-editor"),d=r.find(".ps-js-btn-edit");p.is(":visible")||(a.hide(),n.hide(),p.show(),d.hide(),$submit=p.find(".ps-js-submit"),(i=p.find("textarea")).data("original-value",s=i.val()),i.focus().val("").val(s),p.off("click input"),p.on("click",".ps-js-cancel",function(){i.val(s),p.off("click").hide(),d.show(),e.trim(s)?(a.show(),n.hide()):(a.hide(),n.show())}),p.on("click",".ps-js-submit",e.proxy(function(e){this.save_desc(o,i.val(),e.currentTarget)},this)),p.on("input","textarea",function(o){var t=e(o.currentTarget),i=t.closest(".ps-js-group-desc").find(".ps-js-limit"),s=+t.data("maxlength"),r=t.val();s&&r.length>s&&(r=r.substr(0,s),t.val(r)),i.html(s-r.length),e.trim(r)?$submit.removeAttr("disabled"):$submit.attr("disabled","disabled")}),i.trigger("input"))},t.prototype.save_desc=function(t,i,s){var r,a="save_desc";this.ajax[a]||(this.ajax[a]=!0,i=e.trim(i||""),(r=e(s).find(".ps-js-loading")).show(),o.postJson("groupajax.set_group_description",{group_id:t,description:i,_wpnonce:peepsogroupsdata.nonce_set_group_description},e.proxy(function(o){var t=e(s).closest(".ps-js-group-desc"),n=t.find(".ps-js-group-desc-text"),p=t.find(".ps-js-group-desc-placeholder"),d=t.find(".ps-js-group-desc-editor"),u=t.find(".ps-js-btn-edit"),c=d.find("textarea");this.ajax[a]=!1,r.hide(),o.success?(c.val(i),d.off("click").hide(),u.show(),(i=(i=_.escape(e.trim(i))).replace(/(?:\r\n|\r|\n)/g,"<br />"))?(n.html(i).show(),p.hide()):(n.text(i).hide(),p.show())):o.errors&&psmessage.show("",o.errors[0])},this)))},t.prototype._member_action_confirmation=function(o){return e.Deferred(e.proxy(function(t){o?pswindow.confirm(o,e.proxy(function(){pswindow.hide(),t.resolveWith(this)},this),e.proxy(function(){t.rejectWith(this)},this)):t.resolveWith(this)},this))},t.prototype.member_action=function(t,i){return e.Deferred(e.proxy(function(s){(t||"").indexOf(".")<0&&(t="groupuserajax."+t),o.postJson(t,i,e.proxy(function(e){e.data?s.resolveWith(this,[e.data]):s.rejectWith(this,[e.errors])},this))},this))},t.prototype.init=function(){jQuery(".js-focus-cover").hover(function(){!1===pswindow.is_visible&&jQuery(".js-focus-change-cover").show()},function(){jQuery(".js-focus-change-cover").hide()}),jQuery(".ps-tab__bar").unbind("click");var e=this;this.$cover_image.one("load",function(){e.fix_horizontal_padding()}).each(function(){this.complete&&jQuery(this).load()}),jQuery(window).on("resize.focus-image",jQuery.proxy(this.fix_horizontal_padding_debounced,this))},t.prototype.fix_horizontal_padding=function(){var e;this.$cover_image.css({height:"auto",width:"100%",minWidth:"100%",maxWidth:"100%"}),e=.375*this.$cover_ct.width(),e=Math.max(e,this.$cover_ct.height()),this.$cover_image.height()<e&&this.$cover_image.css({height:e,width:"auto",minWidth:"100%",maxWidth:"none"}),this.initial_cover_position=this.$cover_image.attr("style")},t.prototype.fix_horizontal_padding_debounced=_.debounce(function(){this.fix_horizontal_padding()},300),t.prototype.show_avatar_dialog=function(){jQuery(".ps-js-error").html("");var e=jQuery("#dialog-upload-avatar"),t=e.find("#dialog-upload-avatar-title").html(),i=e.find("#dialog-upload-avatar-content").html(),s=e.find(".dialog-action").html(),r=pswindow.show(t,i).set_actions(s).$container.find(".ps-dialog");r.addClass("ps-dialog-wide"),o.observer.addFilter("pswindow_close",function(){r.removeClass("ps-dialog-wide")},10,1),this.init_avatar_fileupload(),jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-avatar .fileupload:visible").psFileupload("destroy")})},t.prototype.init_avatar_fileupload=function(){var e=this;jQuery(".upload-avatar .fileupload:visible").psFileupload({formData:{group_id:peepsogroupsdata.group_id,_wpnonce:jQuery("#_covernonce").val()},dataType:"json",url:peepsodata.ajaxurl_legacy+"groupajax.avatar_upload?avatar",add:function(e,o){if(o.files[0].type.length&&!/(\.|\/)(jpe?g|png)$/i.test(o.files[0].type)){var t=jQuery("#profile-avatar-error-filetype").text();jQuery(".ps-js-error").html(t)}else if(parseInt(o.files[0].size)>peepsodata.upload_size){var i=jQuery("#profile-avatar-error-filesize").text();jQuery(".ps-js-error").html(i)}else jQuery("#ps-window .ps-loading-image").show(),jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").hide(),jQuery(".ps-js-error").hide(),pswindow.refresh(),o.submit()},done:function(o,t){var i=t.result;if(i.success){var s=jQuery("#dialog-upload-avatar-content",jQuery(i.data.html)),r=jQuery("#dialog-upload-avatar .dialog-action").html(),a="?"+Math.random();jQuery(".js-focus-avatar img",s).attr("src",i.data.image_url+a),jQuery(".imagePreview img",s).attr("src",i.data.orig_image_url+a),jQuery(".imagePreview",s).after('<input type="hidden" name="is_tmp" value="1"/>'),jQuery(".ps-js-has-avatar",s).show(),jQuery(".ps-js-no-avatar",s).hide(),pswindow.set_content(s),pswindow.set_actions(r),jQuery("#imagePreview img").one("load",function(){pswindow.refresh()}),e.init_avatar_fileupload(),jQuery("#ps-window button[name=rep_submit]").removeAttr("disabled").addClass("ps-btn-primary"),e.invalid_avatar_upload=!1,e.avatar_use_gravatar=!1}else jQuery("#ps-window .show-avatar, #ps-window .show-thumbnail, #ps-window .upload-avatar").show(),jQuery(".ps-js-error").html(i.errors).show(),jQuery("#ps-window .ps-loading-image").hide(),jQuery("#ps-window button[name=rep_submit]").attr("disabled","disabled").removeClass("ps-btn-primary"),e.invalid_avatar_upload=!0}})},t.prototype.confirm_avatar=function(e){var t,i;this.invalid_avatar_upload||(t=this.confirm_avatar)._loading||(t._loading=!0,e&&(e=jQuery(e)).attr("disabled","disabled"),i={group_id:peepsogroupsdata.group_id,module_id:peepsogroupsdata.module_id,_wpnonce:jQuery("#_covernonce").val()},o.postJson("groupajax.avatar_confirm",i,function(o){o&&o.success?window.location.reload():(t._loading=!1,e&&e.removeAttr("disabled"))}))},t.prototype.confirm_remove_avatar=function(){var e=jQuery("#delete-confirmation #delete-title").html(),o=jQuery("#delete-confirmation #delete-content").html();pswindow.show(e,o)},t.prototype.remove_avatar=function(e){var t={group_id:peepsogroupsdata.group_id,user_id:e,_wpnonce:jQuery("#_covernonce").val()};o.postJson("groupajax.avatar_delete",t,function(e){e.success&&window.location.reload()})},t.prototype.confirm_remove_cover_photo=function(){var e=jQuery("#delete-confirmation #delete-title").html(),o=jQuery("#delete-confirmation #delete-content").html();pswindow.show(e,o)},t.prototype.remove_cover_photo=function(e){var t={group_id:peepsogroupsdata.group_id,_wpnonce:jQuery("#_covernonce").val()};o.postJson("groupajax.cover_delete",t,function(e){e.success&&window.location.reload()})},t.prototype.reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").hide(),jQuery(".js-focus-change-cover > a",".js-focus-cover").hide(),jQuery(".reposition-cover-actions",".js-focus-cover").show(),jQuery(".js-focus-cover").addClass("ps-focus-cover-edit");var e=this,o=jQuery(".js-focus-cover").height()-jQuery("img#"+peepsogroupsdata.group_id).height(),t=jQuery(".js-focus-cover").width()-jQuery("img#"+peepsogroupsdata.group_id).width();jQuery("img#"+peepsogroupsdata.group_id).draggable({cursor:"move",drag:function(e,i){i.position.top<o&&(i.position.top=o),i.position.top>0&&(i.position.top=0),i.position.left<t&&(i.position.left=t),i.position.left>0&&(i.position.left=0)},stop:function(o,t){var i=jQuery("img#"+peepsogroupsdata.group_id),s=i.closest(".js-focus-cover"),r=100*t.position.top/s.height();r=Math.round(1e4*r)/1e4,y=100*t.position.left/s.width(),y=Math.round(1e4*y)/1e4,e.cover.x_position_percent=r,e.cover.y_position_percent=y,i.css("top",r+"%"),i.css("left",y+"%")}})},t.prototype.cancel_reposition_cover=function(){jQuery(".js-focus-gradient",".js-focus-cover").show(),jQuery(".js-focus-change-cover > a",".js-focus-cover").show(),jQuery(".reposition-cover-actions",".js-focus-cover").hide(),jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit"),jQuery("img#"+peepsogroupsdata.group_id).attr("style",this.initial_cover_position),jQuery("img#"+peepsogroupsdata.group_id).draggable("destroy")},t.prototype.save_reposition_cover=function(){var e={group_id:peepsogroupsdata.group_id,x:this.cover.x_position_percent,y:this.cover.y_position_percent,_wpnonce:jQuery("#_covernonce").val()},t=this;jQuery(".reposition-cover-actions",".js-focus-cover").hide(),jQuery(".ps-reposition-loading",".js-focus-cover").show(),jQuery(".js-focus-cover").removeClass("ps-focus-cover-edit"),o.postJson("groupajax.cover_reposition",e,function(e){jQuery(".ps-reposition-loading",".js-focus-cover").hide(),t.initial_cover_position=jQuery("img#"+peepsogroupsdata.group_id).attr("style"),t.cancel_reposition_cover()})},t.prototype.show_cover_dialog=function(){jQuery(".ps-js-error").html("");var e=jQuery("#dialog-upload-cover"),o=e.find("#dialog-upload-cover-title").html(),t=e.find("#dialog-upload-cover-content").html();pswindow.show(o,t),this.init_cover_fileupload(),jQuery("#ps-window").on("pswindow.hidden",function(){jQuery(".upload-cover .fileupload:visible").psFileupload("destroy")})},t.prototype.init_cover_fileupload=function(){var e=this;jQuery(".upload-cover .fileupload:visible").psFileupload({formData:{group_id:peepsogroupsdata.group_id,module_id:peepsogroupsdata.module_id,_wpnonce:jQuery("#_covernonce").val()},dataType:"json",url:peepsodata.ajaxurl_legacy+"groupajax.cover_upload?cover",add:function(e,o){if(o.files[0].type.length&&!/(\.|\/)(jpe?g|png)$/i.test(o.files[0].type)){var t=jQuery("#profile-cover-error-filetype").text();jQuery(".ps-js-error").html(t)}else if(parseInt(o.files[0].size)>peepsodata.upload_size){var i=jQuery("#profile-cover-error-filesize").text();jQuery(".ps-js-error").html(i)}else jQuery("#ps-window .ps-loading-image").show(),jQuery("#ps-window .upload-cover").hide(),o.submit()},done:function(o,t){var i=t.result;jQuery("#ps-window .ps-loading-image").hide(),jQuery("#ps-window .upload-cover").show(),i.success?(jQuery(".cover-image").attr("src",i.data.image_url+"?"+Math.random()).css("top","0").css("left","0").removeClass("default").addClass("has-cover"),pswindow.fade_out("slow"),jQuery("#profile-reposition-cover").show(),jQuery("#dialog-upload-cover-content").html(i.data.html),pswindow.set_content(jQuery("#dialog-upload-cover-content",i.data.html).html()),e.fix_horizontal_padding_debounced(),e.init_cover_fileupload()):jQuery(".ps-js-error").html(i.errors)}})},t.prototype.showAvatarDialog=function(){var e;peepsogroupsdata.id&&(this.avatarDialog||((e={id:+peepsogroupsdata.id,name:peepsogroupsdata.name,hasAvatar:+peepsogroupsdata.hasAvatar,imgAvatar:peepsogroupsdata.imgAvatar,imgOriginal:peepsogroupsdata.imgOriginal}).hasAvatar||(e.imgOriginal=""),this.avatarDialog=new PsGroupAvatarDialog(e)),this.avatarDialog.show())},t.prototype.edit_property=function(t,i,s){var r=e(t).closest(".ps-js-group-"+s),a=r.find(".ps-js-text"),n=r.find(".ps-js-editor"),p=r.find(".ps-js-btn-edit"),d=r.find(".ps-js-btn-cancel"),u=r.find(".ps-js-btn-submit"),c=n.find('select[name="'+s+'"]'),l=c.val();n.is(":visible")||(a.hide(),p.hide(),d.show(),u.show(),n.show(),c.data("psInitialized")||(c.data("psInitialized",1),c.data("initialValue",l),c.off("change").on("change",function(){var o=e(this),t=o.val(),i=o.data("initialValue");t&&t!==i?u.removeAttr("disabled"):u.attr("disabled","disabled")}),d.off("click").on("click",function(){c.val(c.data("initialValue")),n.hide(),u.hide(),d.hide(),p.show(),a.show()}),u.off("click").on("click",function(){var e=u.find("img"),t=c.val();e.is(":visible")||(e.show(),o.postJson("groupajax.set_group_property",{group_id:i,property_name:s,property_value:t,_wpnonce:peepsogroupsdata.nonce_set_group_property},function(o){e.hide(),o.success&&(c.data("initialValue",t),a.html(c.children("option:selected").text())),d.click()}))})))},t}(e,o)),e(function(){ps_group.init_page(+peepsogroupsdata.group_id)})}(jQuery,peepso);