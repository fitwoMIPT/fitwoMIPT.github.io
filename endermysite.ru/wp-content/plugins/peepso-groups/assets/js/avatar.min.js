!function(t,e){var a,s,o="PsGroupAvatar",p=(a=o,s=t.jQuery,peepso.createClass(a,peepso.npm.EventEmitter,{__constructor:function(t){this._isTemp=!1,this.$file=this._uploadInit(t)},uploadUrl:peepsodata.ajaxurl_legacy+"groupajax.avatar_upload?avatar",uploadParams:function(){return{group_id:peepsogroupsdata.group_id,_wpnonce:peepsodata.groupAvatar.uploadNonce}},upload:function(){this.$file&&this.$file.click()},_uploadInit:function(t){var e,a;return(a=t?s(t):((e=s('<div class="ps-js-uploader-avatar-group" />').css({position:"absolute",left:0,top:-999})).html('<input type="file" name="filedata" accept="image/*" />'),e.appendTo(document.body),e.find("input"))).psFileupload({url:this.uploadUrl,formData:this.uploadParams(),replaceFileInput:!1,dataType:"json",add:s.proxy(function(t,e){var a=peepsodata.groupAvatar,o=e.files[0];/(\.|\/)(gif|jpe?g|png)$/i.test(o.type)?parseInt(o.size)>a.uploadMaxSize?this.emit("uploadfail",a.textErrorFileSize):e.submit():this.emit("uploadfail",a.textErrorFileType)},this),submit:s.proxy(function(){this.emit("uploadsubmit")},this),done:s.proxy(function(t,e){var a,o,p=e.result;p.success?(a=p.data&&p.data.image_url,o=p.data&&p.data.orig_image_url,this._isTemp=!0,this.emit("uploaddone",a,o)):this.emit("uploadfail",p.errors)},this)}),a},crop:function(t,a,o,p,i,r){return s.Deferred(s.proxy(function(e){peepso.postJson("groupajax.avatar_crop",{u:peepsogroupsdata.group_id,x:t,y:a,x2:o,y2:p,width:i,height:r,tmp:this._isTemp?1:0,_wpnonce:peepsodata.groupAvatar.uploadNonce},s.proxy(function(t){t&&t.success?e.resolveWith(this,[t.data&&t.data.image_url]):e.rejectWith(this)},this))},this))},remove:function(){return s.Deferred(s.proxy(function(e){peepso.postJson("groupajax.avatar_delete",{group_id:peepsogroupsdata.id,_wpnonce:peepsodata.groupAvatar.uploadNonce},s.proxy(function(t){t&&t.success?e.resolveWith(this,[t.data&&t.data.image_url]):e.rejectWith(this)},this))},this))},finalize:function(){return s.Deferred(s.proxy(function(e){peepso.postJson("groupajax.avatar_confirm",{group_id:peepsogroupsdata.id,module_id:peepsogroupsdata.module_id,_wpnonce:peepsodata.groupAvatar.uploadNonce},s.proxy(function(t){t&&t.success?e.resolveWith(this):e.rejectWith(this)},this))},this))}}));"object"==typeof module&&module.exports?module.exports=p:t[o]=p}(window);