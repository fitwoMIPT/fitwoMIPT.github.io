!function n(s,a,u){function c(t,e){if(!a[t]){if(!s[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[t]={exports:{}};s[t][0].call(i.exports,function(e){return c(s[t][1][e]||e)},i,i.exports,n,s,a,u)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,t,r){(function(e){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var t,a=(t="undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null)&&t.__esModule?t:{default:t},u=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=r?Object.getOwnPropertyDescriptor(e,i):null;n&&(n.get||n.set)?Object.defineProperty(o,i,n):o[i]=e[i]}o.default=e,t&&t.set(e,o);return o}("undefined"!=typeof window?window.peepso:void 0!==e?e.peepso:null);function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var n=peepsogroupsdata.listItemMemberActionsTemplate,o=function(){function o(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.id=e.id,this.actions=this.constructor.normalize(e),this.template=(0,u.template)(n),this.$el=(0,a.default)("<div />"),this.$el.on("click","[data-method]",function(e){t.onClick(e)}),this.render()}var e,t,r;return e=o,r=[{key:"normalize",value:function(e){var t,o,r;function i(e,t){return _.map(e,function(e){return _.isString(e.action)&&e.action.indexOf(".")<0?e.action=t+"."+e.action:_.isArray(e.action)&&(e.action=i(e.action,t)),e})}return(t=(e=e||{}).group||{}).groupuserajax&&void 0!==t.groupuserajax.member_actions?o=i(t.groupuserajax.member_actions||[],"groupuserajax"):void 0!==e.member_actions&&(o=i(e.member_actions||[],"groupuserajax")),t.groupfollowerajax&&void 0!==t.groupfollowerajax.follower_actions?r=i(t.groupfollowerajax.follower_actions||[],"groupfollowerajax"):void 0!==e.follower_actions&&(r=i(e.follower_actions||[],"groupfollowerajax")),{member_actions:o,follower_actions:r}}}],(t=[{key:"render",value:function(){var e=this.template(_.extend({id:this.id},this.actions));this.$el.html(e)}},{key:"fetch",value:function(){var r=this;return new Promise(function(t,o){var e={group_id:r.id,keys:"groupuserajax.member_actions,groupfollowerajax.follower_actions"};u.default.postJson("groupajax.group",e,function(e){e.success?t(e.data):o(e.errors)})})}},{key:"confirmAction",value:function(o){return new Promise(function(e,t){o?pswindow.confirm(o,function(){pswindow.hide(),e()},function(){t()}):e()})}},{key:"doAction",value:function(i,e){var n=this;return new Promise(function(o,r){u.default.postJson(i,e,function(e){if(e.success)if(i.match(/\.(join|leave)$/)){var t=e.data.member_count;n.fetch().then(function(e){_.extend(e,{member_count:t}),o(e)}).catch(function(e){r(e)})}else o(e.data);else r(e.errors)})})}},{key:"onClick",value:function(e){var o=this;e.preventDefault(),e.stopPropagation();var t=(0,a.default)(e.currentTarget);if(!t.data("ps-loading")){var r=a.default.extend({},t.data());if(r.method&&r.id){var i=t.find("img");!i.length&&t.parent().hasClass("ps-js-dropdown-menu")&&(i=(i=t.parent().siblings(".ps-js-dropdown-toggle")).find("img"),t.parent().hide());var n=r.method,s=r.confirm;r.group_id=r.id,delete r.method,delete r.confirm,delete r.id,this.confirmAction(s).then(function(){t.data("ps-loading",!0),i.show(),o.doAction(n,r).then(function(e){var t=o.constructor.normalize(e);o.actions=_.defaults({},t,o.actions),o.render(),e.member_count&&u.observer.applyFilters("group_update_member_count",o.id,e.member_count)})}).catch(a.default.noop)}}}}])&&i(e.prototype,t),r&&i(e,r),o}();r.default=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,o){"use strict";var r,i,l,p,d=e("./group-actions").default;function n(){p.observer.addFilter("group_update_member_count",function(e,t){var o,r=l(".ps-js-group-item--"+e).find(".ps-js-member-count");r.length&&(o=1<+t?peepsogroupsdata.lang.members:peepsogroupsdata.lang.member,r.html(t+" "+o))},10,2),l(document.body).on("click",".ps-js-groups .ps-js-member-action",l.proxy(function(e){var t,r,o,i,n=l(e.currentTarget);e.preventDefault(),e.stopPropagation(),n.data("ps-loading")||(r=l.extend({},n.data())).method&&r.id&&(!(t=n.find("img")).length&&n.parent().hasClass("ps-js-dropdown-menu")&&(t=(t=n.parent().siblings(".ps-js-dropdown-toggle")).find("img"),n.parent().hide()),o=r.method,i=r.confirm,r.group_id=r.id,delete r.method,delete r.confirm,delete r.id,this._member_action_confirmation(i).done(function(){n.data("ps-loading",!0),t.show(),this.member_action(o,r).done(function(e){var t=n.closest(".ps-js-member-actions"),o=p.template(peepsogroupsdata.listItemMemberActionsTemplate)(l.extend({id:r.group_id},e));t.html(o),e.member_count&&p.observer.applyFilters("group_update_member_count",r.group_id,e.member_count)})}))},this)),l(document.body).on("click",".ps-js-groups .ps-js-more",l.proxy(function(e){var t=".ps-js-group-item",o="ps-group__item--expanded",r=l(e.currentTarget).closest(t);e.preventDefault(),e.stopPropagation(),l(".ps-groups").find(t).each(function(){var e=l(this);e.is(r)&&!e.hasClass(o)?(e.addClass(o),e.find(".ps-js-more span").html(peepsogroupsdata.lang.less)):e.hasClass(o)&&(e.removeClass(o),e.find(".ps-js-more span").html(peepsogroupsdata.lang.more))})},this))}r=jQuery,i=peepso,window.ps_groups=(l=r,p=i,n.prototype._fetch=function(c){return l.Deferred(l.proxy(function(u){var e=(c.category||0)+"";this._fetch_xhr=this._fetch_xhr||{},this._fetch_xhr[e]&&this._fetch_xhr[e].abort(),this._fetch_xhr[e]=p.disableAuth().getJson("groupsajax.search",c,l.proxy(function(e){var t,o,r,i,n=p.template(peepsogroupsdata.listItemTemplate),s=(p.template(peepsogroupsdata.listItemMemberActionsTemplate),e.data||{}),a="";if(s.groups&&s.groups.length){for(i=0;i<s.groups.length;i++)(t=s.groups[i]).nameHighlight=t.name||"",c.query&&(o=c.query.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),o=RegExp("("+o+")","ig"),r='<span style="background:'+p.getLinkColor(.3)+'">$1</span>',t.nameHighlight=t.nameHighlight.replace(o,r),t.description=(t.description||"").replace(o,r)),t.description=l("<div/>").html(t.description||"").text(),a+=n(l.extend({},t,{member_actions:""})),_.defer(function(e){var t,o=l(".ps-js-group-item--"+e.id).find(".ps-js-member-actions");t=new d({id:e.id,member_actions:e.groupuserajax.member_actions,follower_actions:e.groupfollowerajax.follower_actions}),o.html(t.$el)},t);u.resolveWith(this,[a])}else 1<c.page?u.resolveWith(this,[null]):u.rejectWith(this,[e.errors])},this))},this))},n.prototype._member_action_confirmation=function(t){return l.Deferred(l.proxy(function(e){t?pswindow.confirm(t,l.proxy(function(){pswindow.hide(),e.resolveWith(this)},this),l.proxy(function(){e.rejectWith(this)},this)):e.resolveWith(this)},this))},n.prototype.member_action=function(e,o){return l.Deferred(l.proxy(function(t){(e||"").indexOf(".")<0&&(e="groupuserajax."+e),p.postJson(e,o,l.proxy(function(e){e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])},this))},this))},new n)},{"./group-actions":1}],3:[function(e,t,o){"use strict";e("./postbox"),e("./groups"),e("./page-groups"),e("./page-groups-categories")},{"./groups":2,"./page-groups":5,"./page-groups-categories":4,"./postbox":6}],4:[function(e,t,o){"use strict";function r(){r.super_.apply(this,arguments)&&n(n.proxy(this.init_page,this))}var i,n,s,a,u;i=jQuery,new(n=i,s=peepsodata.groups&&peepsodata.groups.categories||{},a=+s.groups_categories_expand_all,u=+s.groups_categories_group_count||4,peepso.npm.inherits(r,PsPageAutoload),peepso.npm.objectAssign(r.prototype,{init_page:function(){this._search_$ct.on("click",".ps-js-groups-cat .ps-accordion__title",n.proxy(this._toggle,this))},_search_url:"groupcategoriesajax.search",_search_params:{keys:"id,name,description,url,groups_count",page:1},_search_debounced:_.debounce(function(){this._fetch(this._search_params).done(function(e){var t=this._search_render_html(e&&e.group_categories);this._search_toggle_loading("hide"),t?(this._search_$ct.append(t),this._search_toggle_autoscroll("on")):(this._render_uncategorized(),this._search_$nomore.show())}).fail(function(e){this._search_toggle_loading("hide"),this._search_params.page<=1?this._render_uncategorized().done(n.proxy(function(){this._search_$nomore.show()},this)).fail(n.proxy(function(){this._search_$ct.html(e.join("<br>"))},this)):(this._render_uncategorized(),this._search_$nomore.show())})},500),_search_render_html:function(e){var t,o=peepso.template(peepsogroupsdata.listCategoriesTemplate),r=null;return e&&e.length&&(r="",_.each(e,function(e){r+=o(_.extend({},e)),t=t||e})),a?setTimeout(n.proxy(function(){this._search_$ct.find(".ps-js-groups-cat").filter(function(){return n(this).find(".ps-accordion__action i").hasClass("ps-icon-expand")}).find(".ps-accordion__title").trigger("click")},this),1):t&&0<+t.groups_count&&setTimeout(n.proxy(function(){this._unfold_first_row||(this._unfold_first_row=!0,this._search_$ct.find(".ps-js-groups-cat").eq(0).find(".ps-accordion__title").trigger("click"))},this),1),r},_search_get_items:function(){return this._search_$ct.children(".ps-accordion__item")},_fetch:function(e){return n.Deferred(n.proxy(function(t){e=n.extend({},e),_.isUndefined(e.limit)||(e.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=peepso.disableAuth().disableError().getJson(this._search_url,e,n.proxy(function(e){e.success?t.resolveWith(this,[e.data]):t.rejectWith(this,[e.errors])},this))},this))},_toggle:function(e){e.preventDefault(),e.stopPropagation(),this._toggle_throttled(e)},_toggle_throttled:_.throttle(function(e){var t=n(e.currentTarget).find(".ps-accordion__action i"),o=t.closest(".ps-js-groups-cat"),r="ps-icon-collapse";t.hasClass(r)?(t.attr("class","ps-icon-expand"),o.find(".ps-js-groups").hide(),this._collapse(o)):(t.attr("class",r),o.find(".ps-js-groups").show(),this._expand(o))},500),_expand:function(t){var e,o="ps-js-loaded";t.addClass("current"),t.hasClass(o)||(e={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:t.data("id"),order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:u,page:1},ps_groups._fetch(e).done(function(e){t.addClass(o),t.find(".ps-js-groups").html(e),t.find(".ps-accordion__footer").show()}).fail(function(e){t.addClass(o),t.find(".ps-js-groups").html(e.join("<br>")),t.find(".ps-accordion__footer").remove()}))},_collapse:function(e){e.removeClass("current")},_render_uncategorized:function(){var r=this;return n.Deferred(function(o){var e={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:-1,order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:1,page:1};ps_groups._fetch(e).done(function(){var e,t;e=[{id:"-1",name:peepsogroupsdata.lang.uncategorized}],(t=r._search_render_html(e))&&r._search_$ct.append(t),o.resolve()}).fail(function(e){o.reject()})})}}),r)(".ps-js-group-cats")},{}],5:[function(o,e,t){(function(e){"use strict";var u=t("undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null),c=t("undefined"!=typeof window?window._:void 0!==e?e._:null),l=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==a(e)&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=r?Object.getOwnPropertyDescriptor(e,i):null;n&&(n.get||n.set)?Object.defineProperty(o,i,n):o[i]=e[i]}o.default=e,t&&t.set(e,o);return o}("undefined"!=typeof window?window.peepso:void 0!==e?e.peepso:null),p=t(o("./group-actions"));function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function t(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function d(e,t,o){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,o){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(o):i.value}})(e,t,o||e)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var _=peepsogroupsdata.listItemTemplate,g=peepsogroupsdata.listItemMemberActionsTemplate;new(function(){function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=n(this,h(o).call(this,e)))._search_url="groupsajax.search",t._search_params={uid:peepsodata.currentuserid,user_id:void 0,query:"",category:0,order_by:void 0,order:void 0,admin:void 0,keys:"id,name,description,date_created_formatted,members_count,url,published,avatar_url_full,privacy,groupuserajax.member_actions,groupfollowerajax.follower_actions",limit:2,page:1},t}var e,t,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(o,PsPageAutoload),e=o,(t=[{key:"onDocumentLoaded",value:function(){var t=this;if(!1===d(h(o.prototype),"onDocumentLoaded",this).call(this))return!1;this._search_$query=(0,u.default)(".ps-js-groups-query"),this._search_$sortby=(0,u.default)(".ps-js-groups-sortby"),this._search_$sortorder=(0,u.default)(".ps-js-groups-sortby-order"),this._search_$category=(0,u.default)(".ps-js-groups-category"),this._search_params.user_id=+peepsodata.userid||void 0,this._search_params.category=this._search_$category.val()||0,this._search_$query.on("input",function(){t._filter()}),this._search_$sortby.on("change",function(){t._filter()}),this._search_$sortorder.on("change",function(){t._filter()}),this._search_$category.on("change",function(e){t._filter_category(e)}),(0,u.default)(".ps-form-search-opt").on("click",function(){t._toggle()}),this._filter()}},{key:"_search_render_html",value:function(e){var t,o,r,i,n=(0,l.template)(_),s=((0,l.template)(g),this._search_params.query),a="";if(e.groups&&e.groups.length)for(i=0;i<e.groups.length;i++)(t=e.groups[i]).nameHighlight=t.name||"",t.description=(0,u.default)("<div/>").html(t.description||"").text(),s&&(o=c.default.filter(s.split(" "),function(e){return""!==e}),o=c.default.map(o,function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}),o=RegExp("("+o.join("|")+")","ig"),r='<span style="background:'+l.default.getLinkColor(.3)+'">$1</span>',t.nameHighlight=t.nameHighlight.replace(o,r),t.description=(t.description||"").replace(o,r)),a+=n(u.default.extend({},t,{member_actions:""})),c.default.defer(function(e){var t,o=(0,u.default)(".ps-js-group-item--"+e.id).find(".ps-js-member-actions");t=new p.default({id:e.id,member_actions:e.groupuserajax.member_actions,follower_actions:e.groupfollowerajax.follower_actions}),o.html(t.$el)},t);return a}},{key:"_search_get_items",value:function(){return this._search_$ct.children(".ps-group__item-wrapper")}},{key:"_search_should_load_more",value:function(){var e,t=+peepsodata.activity_limit_below_fold,o=this._search_get_items();return this._search_loadmore_enable&&this._search_loadmore_repeat?!(o.length>=this._search_loadmore_repeat*this._search_params.page):(t=0<t?t:3,this._search_params.limit&&(t*=this._search_params.limit),!!((e=o.slice(0-t).eq(0)).length&&(this._search_loadmore_enable?e.eq(0).offset():e.get(0).getBoundingClientRect()).top<(window.innerHeight||document.documentElement.clientHeight)))}},{key:"_fetch",value:function(r){var i=this;return u.default.Deferred(function(t){var e=l.default.disableAuth().disableError(),o=i._search_url;r=u.default.extend({},r),i._search_loadmore_enable&&i._search_loadmore_repeat?r.limit=i._search_loadmore_repeat:c.default.isUndefined(r.limit)||(r.limit*=2),i._fetch_xhr&&i._fetch_xhr.abort(),i._fetch_xhr=e.getJson(o,r,function(e){e.success?t.resolveWith(i,[e.data]):t.rejectWith(i,[e.errors])})})}},{key:"_filter",value:function(){this._fetch_xhr&&this._fetch_xhr.abort(),this._search_params.query=u.default.trim(this._search_$query.val()),this._search_params.category=this._search_$category.val(),this._search_params.order_by=this._search_$sortby.val(),this._search_params.order=this._search_$sortorder.val(),this._search_params.page=1,this._search()}},{key:"_filter_category",value:function(e){this._filter();var t=window.location.href,o=/(category=)-?\d+/,r=e.target.value||0;t.match(o)&&(t=t.replace(o,"$1"+r),window.history&&history.pushState&&history.pushState(null,"",t))}},{key:"_toggle",value:function(){(0,u.default)(".ps-js-page-filters").stop().slideToggle()}}])&&i(e.prototype,t),r&&i(e,r),o}())(".ps-js-groups")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./group-actions":1}],6:[function(e,t,o){(function(e){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i=t("undefined"!=typeof window?window.jQuery:void 0!==e?e.jQuery:null),n=(t("undefined"!=typeof window?window._:void 0!==e?e._:null),function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!=typeof e)return{default:e};var t=u();if(t&&t.has(e))return t.get(e);var o={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var n=r?Object.getOwnPropertyDescriptor(e,i):null;n&&(n.get||n.set)?Object.defineProperty(o,i,n):o[i]=e[i]}o.default=e,t&&t.set(e,o);return o}("undefined"!=typeof window?window.peepso:void 0!==e?e.peepso:null)),a="undefined"!=typeof window?window.peepsodata:void 0!==e?e.peepsodata:null;function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function t(e){return e&&e.__esModule?e:{default:e}}function c(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var l=window.peepsogroupsdata.module_id,o=function(){function t(e){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.$postbox=e,this.$container=this.$postbox.find("#group-tab"),this.$toggle=this.$container.find(".interaction-icon-wrapper"),this.$selected=this.$container.find(".ps-icon-html-groups").hide(),this.$dropdown=this.$postbox.find(".ps-js-postbox-group"),this.$radio=this.$container.find("[type=radio]"),this.$finder=this.$container.find(".ps-js-group-finder"),this.$search=this.$finder.find("input[type=text]"),this.$loading=this.$finder.find(".ps-js-loading"),this.$result=this.$finder.find(".ps-js-result"),this.resultTemplate=n.default.template(this.$result.find(".ps-js-result-item-template").text()),this.$toggle.on("click",function(){return o.toggle()}),this.$dropdown.on("click","[data-option-value]",function(e){var t=(0,i.default)(e.currentTarget).data("optionValue");e.stopPropagation(),o.select(t),"group"!==t&&o.hide()}),this.$postbox.on("postbox.post_cancel postbox.post_saved",function(){return o.remove()}),n.observer.addFilter("postbox_req",i.default.proxy(this.filterPostboxReq,this),10,1),n.observer.addAction("postbox_schedule_set",i.default.proxy(this.actionPostboxScheduleSet,this),10,1),n.observer.addAction("postbox_schedule_reset",i.default.proxy(this.actionPostboxScheduleReset,this),10,1)}var e,o,r;return e=t,(o=[{key:"toggle",value:function(){this.$dropdown.is(":hidden")?this.show():this.hide()}},{key:"show",value:function(){var t=this;this.$dropdown.show(),setTimeout(function(){var e="click.ps-postbox-group";(0,i.default)(document).off(e).one(e,function(){return t.hide()})},1)}},{key:"hide",value:function(){this.$dropdown.hide(),this.$radio.get(1).checked&&!this.value()&&(this.$radio.get(0).checked=!0,this.$finder.hide(),this.$container.removeClass("active"),this.$selected.hide()),(0,i.default)(document).off("click.ps-postbox-group")}},{key:"value",value:function(){var e;return this.$radio.get(1).checked&&this.selectedGroup&&(e=this.selectedGroup),e}},{key:"select",value:function(e){"group"!==e?(this.remove(),this.hide()):"group"===e&&(this.$radio.get(1).checked=!0,this.$finder.show(),this.initFinder())}},{key:"remove",value:function(){this.selectedGroup=void 0,this.$radio.get(0).checked=!0,this.$finder.hide(),this.$container.removeClass("active"),this.$selected.hide(),n.observer.doAction("postbox_group_reset",this.$postbox)}},{key:"search",value:function(t,o){var e,r,i=this;return t=(t||"").trim(),o=parseInt(o)||1,e={uid:a.currentuserid,user_id:a.currentuserid,query:t,writable_only:1,keys:"id,name,description,avatar_url_full,privacy",order_by:"post_title",order:"ASC",limit:10,page:o},r=function(e){e&&e.data&&(i.query=t,i.page=o,i.render(e.data,o),i.searchEnd=!(e.data&&e.data.groups&&e.data.groups.length))},this.xhr&&this.xhr.abort(),this.xhr=n.default.disableAuth().getJson("groupsajax.search",e,r),this.xhr}},{key:"render",value:function(e,t){var o=this.$result.children("ul");if(e=e||{},1===(t=t||1)&&o.empty(),e&&e.groups&&e.groups.length)for(var r=0;r<e.groups.length;r++)o.append(this.resultTemplate(e.groups[r]));else 1===t&&o.append("<li><em>".concat(a.groups.textNoResult,"</em></li>"))}},{key:"initFinder",value:function(){var e=this;this._initialSearch||(this.$search.on("keydown",i.default.proxy(this.onQueryEnter,this)),this.$search.on("input",i.default.proxy(this.onQueryInput,this)),this.$search.on("click",function(e){return e.stopPropagation()}),this.$result.on("click","[data-id]",i.default.proxy(this.onResultSelect,this)),this.$result.on("scroll",i.default.proxy(this.onResultScroll,this)),this.$result.hide(),this.$loading.show(),this.search().always(function(){e.$loading.hide(),e.$result.show()}),this._initialSearch=!0)}},{key:"onQueryInput",value:function(){var e=this.$search.val(),t=e.replace(/^\s+/,"");e!==t&&this.$search.val(t),this.$result.hide(),this.$loading.show(),clearTimeout(this._onQueryTimer),this._onQueryTimer=setTimeout(i.default.proxy(function(){this.search(t,1).always(i.default.proxy(function(){this.$loading.hide(),this.$result.show()},this))},this),1e3)}},{key:"onQueryEnter",value:function(e){var t;13===e.keyCode&&(e.preventDefault(),t=this.$search.val().replace(/(^\s+|\s+$)/g,""),clearTimeout(this._onQueryTimer),this.$result.hide(),this.$loading.show(),this.search(t,1).always(i.default.proxy(function(){this.$loading.hide(),this.$result.show()},this)))}},{key:"onResultSelect",value:function(e){var t=(0,i.default)(e.currentTarget),o=t.data("id"),r=t.data("name");this.selectedGroup=o,this.$container.addClass("active"),this.$selected.html(r).show(),this.hide(),n.observer.doAction("postbox_group_set",this.$postbox,this.selectedGroup)}},{key:"onResultScroll",value:function(e){var t=this;e.stopPropagation(),!this.searchEnd&&this.$loading.is(":hidden")&&this.$result[0].scrollHeight<=this.$result.scrollTop()+this.$result.innerHeight()&&(this.$loading.show(),this.search(this.query,this.page+1).always(function(){return t.$loading.hide()}))}},{key:"filterPostboxReq",value:function(e){var t=this.value();return t&&(e.module_id=l,e.group_id=t,e.force_as_group_post=1,e.acc=void 0),e}},{key:"actionPostboxScheduleSet",value:function(e){e===this.$postbox&&(this.select(""),this.$container.hide())}},{key:"actionPostboxScheduleReset",value:function(e){e===this.$postbox&&this.$container.show()}}])&&c(e.prototype,o),r&&c(e,r),t}();n.observer.addAction("peepso_postbox_addons",function(e){var t={init:function(){},set_postbox:function(e){e.find("#group-tab").length&&new o(e)}};return e.push(t),e},10,1),n.observer.addAction("postbox_init",function(e){e.$tabContext.find("#group-tab").remove()},10,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[3]);