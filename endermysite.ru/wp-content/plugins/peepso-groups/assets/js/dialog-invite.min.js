!function(){var t=function(e,o){return peepso.createClass(e,{__constructor:function(e){this.$el=o(peepsogroupsdata.dialogInviteTemplate);this.$loading=this.$el.find(".ps-js-loading").hide();this.$list=this.$el.find(".ps-js-member-items").hide();this.itemTemplate=this.$el.find(".ps-js-member-item").html();this.itemTemplate=peepso.template(this.itemTemplate);this.$el.on("input","input[type=text]",o.proxy(this.onInput,this));this.$el.on("click",".ps-js-invite",o.proxy(this.onInvite,this));this.$el.on("click",".ps-js-cancel",o.proxy(this.onClose,this));this.$el.appendTo(document.body);this.groupId=e;this.search()},search:function(e){this.$loading.show();this.$list.hide();this._search(e)},_search:_.debounce(function(e){var t={group_id:this.groupId,query:e||undefined,keys:"id,avatar,fullname,profileurl,fullname_with_addons",page:1};this.fetch(t).done(this.render).fail(this.renderError)},500),fetch:function(e){return o.Deferred(o.proxy(function(t){peepso.getJson("groupusersajax.search_to_invite",e,o.proxy(function(e){this.$loading.hide();this.$list.empty().show();if(e.success){t.resolveWith(this,[e.data])}else{t.rejectWith(this,[e.errors])}},this))},this))},render:function(e){var t="",i;if(e.users&&e.users.length){for(var i=0;i<e.users.length;i++){t+=this.itemTemplate(o.extend({group_id:this.groupId},e.users[i]))}this.$list.append(t)}},renderError:function(e){if(e&&e.length){this.$list.append(e.join("<br />"))}},invite:function(e){return o.Deferred(o.proxy(function(t){ps_group.inviteUser(this.groupId,e).done(o.proxy(function(e){t.resolveWith(this,[e])},this)).fail(o.proxy(function(e){t.rejectWith(this,[e])},this))},this))},close:function(e){if(e){window.location.reload()}else{this.$el.remove()}},onInput:function(e){e.preventDefault();e.stopPropagation();this.search(o.trim(e.target.value))},onInvite:function(e){var t=o(e.currentTarget),i=t.find("img").show(),s=t.find("span"),n=t.data("id");e.preventDefault();e.stopPropagation();this.invite(n).always(function(){i.hide()}).done(function(){s.html(s.data("invited"));t.attr("disabled","disabled")})},onClose:function(e){e.preventDefault();e.stopPropagation();var t=o(e.currentTarget);var i=+t.data("reload-on-close");this.close(i)}})}("PsGroupDialogInvite",jQuery);peepso.groups||(peepso.groups={}),peepso.groups.dlgInvite=function(e){new t(e)}}();