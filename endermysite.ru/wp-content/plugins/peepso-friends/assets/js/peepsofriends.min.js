!function(e,s){psfriends=s.friends=function(r,a){function e(){}var s=new e;return e.prototype.init=function(){r(document).on("peepsofriends_request",function(e,i){var s={user_id:i};a.postJson("friendsajax.get_request_options",s,function(e){var s=r('.friend-request-option[data-user-id="'+i+'"]'),t=s.first().parent();s.remove(),t.prepend(r(e.data.options).filter(".friend-request-option")),r('.ps-members-item-buttons[data-user-id="'+i+'"]').each(function(){r(this).replaceWith(e.data.buttons)})})})},e.prototype.set_follow_status=function(s,e,t){if(!this.sending_request){t&&(t=jQuery(t)).find("img").css("display","inline");var i={uid:peepsodata.currentuserid,user_id:s,follow:e};this.sending_request=!0,a.postJson("friendsajax.set_follow_status",i,r.proxy(function(e){this.sending_request=!1,r(".ps-js-focus--"+s).find(".ps-focus-actions, .ps-focus-actions-mobile").html(e.data.actions),t&&e.data&&e.data.buttons_notif&&t.closest(".ps-popover-actions").html(e.data.buttons_notif),r(document).trigger("peepsofriends_request",[s])},this))}},e.prototype.send_request=function(s,t){if(!this.sending_request){t&&(t=jQuery(t)).find("img").css("display","inline");var e={uid:peepsodata.currentuserid,user_id:s};this.sending_request=!0,a.postJson("friendsajax.send_request",e,r.proxy(function(e){this.sending_request=!1,r(".ps-js-focus--"+s).find(".ps-focus-actions, .ps-focus-actions-mobile").html(e.data.actions),t&&e.data&&e.data.buttons_notif&&t.closest(".ps-popover-actions").html(e.data.buttons_notif),r(document).trigger("peepsofriends_request",[s])},this))}},e.prototype.cancel_request=function(s,e,t){if(!this.canceling_request){t&&(t=jQuery(t)).find("img").css("display","inline");var i={uid:peepsodata.currentuserid,user_id:peepsodata.userid,request_id:s,action:e};this.canceling_request=!0,a.postJson("friendsajax.cancel_request",i,r.proxy(function(e){this.canceling_request=!1,r(".ps-js-focus--"+i.user_id).find(".ps-focus-actions, .ps-focus-actions-mobile").html(e.data.actions),t&&e.data&&e.data.buttons_notif&&t.closest(".ps-popover-actions").html(e.data.buttons_notif),a.observer.applyFilters("friendsrequests_cancel_request",s,e,i),r(document).trigger("peepsofriends_request",[e.data.user_id])},this))}},e.prototype.accept_request=function(s,e){if(!this.accepting_request){e&&(e=jQuery(e)).find("img").css("display","inline");var t={uid:peepsodata.currentuserid,request_id:s};this.accepting_request=!0,a.postJson("friendsajax.accept_request",t,r.proxy(function(e){this.accepting_request=!1,r(".ps-js-focus--"+e.data.user_id).find(".ps-focus-actions, .ps-focus-actions-mobile").html(e.data.actions),a.observer.applyFilters("friendsrequests_accept_request",s,e,t),r(document).trigger("peepsofriends_request",[e.data.user_id])},this))}},e.prototype.remove_friend=function(s){if(!this.removing_request){this.remove_elem&&(this.remove_elem=jQuery(this.remove_elem),this.remove_elem.find("img").css("display","inline"));var t={uid:peepsodata.currentuserid,user_id:s};this.removing_request=!0,a.postJson("friendsajax.remove_friend",t,r.proxy(function(e){this.removing_request=!1,r(".ps-js-focus--"+s).find(".ps-focus-actions, .ps-focus-actions-mobile").html(e.data.actions),this.remove_elem&&e.data&&e.data.buttons_notif&&this.remove_elem.closest(".ps-popover-actions").html(e.data.buttons_notif),a.observer.applyFilters("friendsrequests_remove_friend",s,e,t),r(document).trigger("peepsofriends_request",[s]),pswindow.hide(),setTimeout(function(){psmessage.show(e.data.header,e.data.message,psmessage.fade_time)},Math.min(1e3,psmessage.fade_time))},this))}},e.prototype.remove_friend_confirmation=function(e,s){if(!this.removing_request){this.remove_elem=s;var t=peepsofriendsdata.removefriend_popup_title,i=peepsofriendsdata.removefriend_popup_content,n=['<button type="button" class="ps-btn ps-btn-small ps-button-cancel" onclick="return pswindow.do_no_confirm();">',peepsofriendsdata.removefriend_popup_cancel,"</button>",'<button type="button" class="ps-btn ps-btn-small ps-button-action" onclick="return peepso.friends.remove_friend('+e+');">',peepsofriendsdata.removefriend_popup_save,"</button>"].join(" ");pswindow.show(t,i).set_actions(n)}},e.prototype.accept_notification_request=function(s,t){var i=r(".ps-js-friends-notification").find(".ps-js-counter"),n=+i.eq(0).html().trim();i.html(n-1).css("display",0<n-1?"":"none"),a.postJson("friendsajax.accept_request",{uid:peepsodata.currentuserid,request_id:t},function(e){if(!e.success)return n=+i.eq(0).html().trim(),void i.html(n+1).css("display","");s&&e.data&&e.data.buttons_notif&&r(s).closest(".ps-popover-actions").html(e.data.buttons_notif),r(".ps-js-focus--"+e.data.user_id).find(".ps-focus-actions, .ps-focus-actions-mobile").html(e.data.actions),a.observer.applyFilters("friendsrequests_accept_request",t,e,req)})},e.prototype.ignore_notification_request=function(s,t){var i=r(".ps-js-friends-notification").find(".ps-js-counter"),n=+i.eq(0).html().trim();i.html(n-1).css("display",0<n-1?"":"none"),a.postJson("friendsajax.cancel_request",{uid:peepsodata.currentuserid,request_id:t,action:"ignore"},function(e){if(!e.success)return n=+i.eq(0).html().trim(),void i.html(n+1).css("display","");r(s).closest(".ps-notification__wrapper").fadeOut(),a.observer.applyFilters("friendsrequests_cancel_request",t,e,req)})},e.prototype.submit_search=function(e){var s=r('input[name="query"]',e);return""!==r.trim(s.val())&&(s.val(encodeURIComponent(s.val())),!0)},e.prototype.show_mutual_friends=function(e,s){var t={from_id:e,to_id:s};this.show_mutual_friends_ajax&&this.show_mutual_friends_ajax.ret&&this.show_mutual_friends_ajax.ret.abort(),this.show_mutual_friends_ajax=!1;var o=r.proxy(_.debounce(function(s){this.show_mutual_friends_ajax||(t.page=(t.page||0)+1,this.show_mutual_friends_ajax=a.postJson("friendsajax.get_mutual_friends",t,r.proxy(function(e){this.show_mutual_friends_ajax=!1,s(e)},this)))},500),this);o(function(e){var s,t,i,n;e.success&&(t=(s=e.data||{}).title,i=s.template.replace("##friends##",s.friends),pswindow.hide(),n=pswindow.show(t,i),r("html").css("overflow","hidden"),a.observer.addFilter("pswindow_close",function(){r("html").css("overflow","")}),n.$container.find(".ps-members-item-popup").on("scroll",function(){var s,t,e=r(this);e.scrollTop()+e.innerHeight()>=this.scrollHeight-5&&(s=n.$container.find(".ps-members-item-popup"),t=s.next("img").show(),o(function(e){t.hide(),e.success&&(s.append(e.data.friends),+e.data.found_friends||s.off("scroll"))}))}))})},e.prototype.select_menu=function(e){var s=r(e.options[e.selectedIndex]),t=s.val(),i=s.data("url");(window.location+"").match(/\/requests/)&&i.match(/\/requests/)?r(".ps-js-friends-submenu").siblings(".tab-content").find("sent-request"===t?"#sent":"#received").addClass("active").siblings().removeClass("active"):window.location=s.data("url")},r(function(){r(".ps-js-friends-notification").psnotification({view_all_link:peepsofriendsdata.friend_requests_page,source:"friendsajax.get_requests"}),s.init()}),s}(e,s)}(jQuery||$,peepso);