!function n(l,p,r){function a(e,t){if(!p[e]){if(!l[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(u)return u(e,!0);var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}var i=p[e]={exports:{}};l[e][0].call(i.exports,function(t){return a(l[e][1][t]||t)},i,i.exports,n,l,p,r)}return p[e].exports}for(var u="function"==typeof require&&require,t=0;t<r.length;t++)a(r[t]);return a}({1:[function(t,e,o){"use strict";t("./peepsopolls")},{"./peepsopolls":2}],2:[function(s,t,e){(function(t){"use strict";function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var e,p=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},r=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==l(t)&&"function"!=typeof t)return{default:t};var e=u();if(e&&e.has(t))return e.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=s?Object.getOwnPropertyDescriptor(t,i):null;n&&(n.get||n.set)?Object.defineProperty(o,i,n):o[i]=t[i]}o.default=t,e&&e.set(t,o);return o}("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),i="undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null,a=s("./polls");function u(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return u=function(){return t},t}function o(){this.allow_multiple=null,this.textarea=null}r.default.polls=new o,o.prototype.init=function(){var s=this,t=this.$postbox.$textarea.attr("placeholder");(0,p.default)(this.$postbox.$posttabs).on("peepso_posttabs_show-polls",function(t,e,o){(0,p.default)("#poll-post",s.$postbox).addClass("active"),e.show(),void 0!==s.$postbox.$textarea&&s.$postbox.$textarea.attr("placeholder",i.polls.textPostboxPlaceholder),(0,p.default)(".ps-postbox-status",o.options.container).show()}),r.observer.addAction("postbox_type_set",function(t,e){t===s.$postbox&&"polls"===e&&t.find("#poll-post.ps-postbox__menu-item").click()},10,2),this.allow_multiple=(0,p.default)(".allow-multiple",this.$postbox),this.$postbox.$posttabs.on("peepso_posttabs_submit-polls",function(){function t(t){return s.set_post_filter(t)}r.observer.addFilter("postbox_req_"+s.$postbox.guid,t,10,1),s.$postbox.save_post(),r.observer.removeFilter("postbox_req_"+s.$postbox.guid,t,10,1)}),this.$postbox.$posttabs.on("peepso_posttabs_cancel-polls",function(){(0,p.default)("#poll-post",s.$postbox).removeClass("active"),s.$postbox.$textarea.attr("placeholder",t),s.on_cancel()}),(0,p.default)("#poll-post",this.$postbox).on("click",function(){"polls"!==s.$postbox.$posttabs.current_tab().data("tab")&&((0,p.default)(s.$postbox.$posttabs).find("[data-tab='polls']").trigger("click"),s.$postbox.$textarea.focus())}),this.save_post=jQuery.proxy(window.activity.option_savepost,window.activity),window.activity.option_savepost=function(t){s.option_savepost(t)},this.$postbox.on("keyup",".ps-poll__option input",p.default.proxy(_.throttle(function(){this.$postbox.on_change()},1e3),this)),this.$postbox.on("click","#ps-add-new-option",p.default.proxy(function(t){var e=(0,p.default)(t.currentTarget).closest(".ps-js-polls"),o=e.find(".ps-poll__option").eq(0).clone();o.find("input").val(""),e.find(".ui-sortable").append(o),this.reorder_placeholder(e),this.$postbox.on_change()},this)),this.$postbox.on("click","#ps-delete-option",p.default.proxy(function(t){var e=(0,p.default)(t.currentTarget),o=e.closest(".ps-js-polls");t.preventDefault(),2<e.closest(".ps-js-polls").find(".ps-poll__option").length&&(e.closest(".ps-poll__option").remove(),this.reorder_placeholder(o),this.$postbox.on_change())},this)),r.observer.addFilter("peepso_postbox_can_submit",function(t){var e,o=this.$postbox,s=o.$posttabs,i=!0,n=[];return"polls"===s.current_tab_id&&(""===p.default.trim(o.$textarea.val())?i=!1:(e=o.find(".ps-poll__option input")).length<2?i=!1:e.each(function(){var t=p.default.trim(this.value);return t?0<=n.indexOf(t)?i=!1:void n.push(t):i=!1}),t.hard.push(i)),t},30,1,this),(0,p.default)(".ps-js-polls .ui-sortable").sortable({handle:".ps-js-handle",update:p.default.proxy(function(t,e){this.reorder_placeholder(e.item.closest(".ps-js-polls"))},this)})},o.prototype.set_postbox=function(t){this.$postbox=t},o.prototype.on_cancel=function(){this.preview_request&&(this.preview_request.ret.abort(),(0,p.default)(".ps-js-polls .ps-postbox-input .ps-postbox-loading",this.$postbox).hide());for(var t=(0,p.default)(".ps-poll__option input",this.$postbox),e=0;e<=t.length;e++)e<=1?t.eq(e).val(""):t.eq(e).closest(".ps-poll__option").remove();0<this.allow_multiple.length&&this.allow_multiple.prop("checked",!1),(0,p.default)("#ps-polls-input",this.$postbox).hide(),(0,p.default)(".ps-js-polls .ps-postbox-preview",this.$postbox).hide().html(""),this.$postbox.on_change()},o.prototype.set_post_filter=function(t){t.options=[];for(var e,o=(0,p.default)(".ps-poll__option input",this.$postbox),s=0;s<=o.length;s++)(e=o.eq(s).val())&&t.options.push(e);return(t.allow_multiple=0)<this.allow_multiple.length&&this.allow_multiple.is(":checked")&&(t.allow_multiple=1),t.type="poll",t},o.prototype.submit_vote=function(t,e){var o,s=(0,p.default)(e),i=s.find("img"),n=s.closest(".ps-js-poll-item").find(".ps-js-poll-item-option"),l=[];n.filter(":checked").each(function(){l.push(this.value)}),s.attr("disabled","disabled"),i.show(),r.default.postJson("pollsajax.submit_vote",{user_id:peepsodata.currentuserid,poll_id:t,polls:l},p.default.proxy(function(t){s.removeAttr("disabled"),i.hide(),t.success?t.data&&t.data.html&&((o=s.closest(".ps-js-activity")).find(".ps-stream-attachments").html(t.data.html),o.find(".ps-js-poll-option-changevote").show(),(0,a.initActivities)()):t.errors&&window.psmessage.show("",t.errors).fade_out(window.psmessage.fade_time)},this))},o.prototype.change_vote=function(t,e){var o,s=(0,p.default)(e);r.default.postJson("pollsajax.change_vote",{user_id:peepsodata.currentuserid,poll_id:t},p.default.proxy(function(t){t.success?t.data&&t.data.html&&((o=s.closest(".ps-js-activity")).find(".ps-stream-attachments").html(t.data.html),o.find(".ps-js-poll-option-changevote").show(),(0,a.initActivities)()):t.errors&&window.psmessage.show("",t.errors).fade_out(window.psmessage.fade_time)},this))},o.prototype.unvote=function(t,e){var o,s=(0,p.default)(e),i=s.find("img");s.attr("disabled","disabled"),i.show(),r.default.postJson("pollsajax.unvote",{user_id:peepsodata.currentuserid,poll_id:t},p.default.proxy(function(t){s.removeAttr("disabled"),i.hide(),t.success?t.data&&t.data.html&&((o=s.closest(".ps-js-activity")).find(".ps-stream-attachments").html(t.data.html),o.find(".ps-js-poll-option-changevote").hide(),(0,a.initActivities)()):t.errors&&window.psmessage.show("",t.errors).fade_out(window.psmessage.fade_time)},this))},o.prototype.reorder_placeholder=function(t){var e=i.polls.textOptionPlaceholder;t.find(".ps-poll__option input[type=text]").each(function(t){(0,p.default)(this).attr("placeholder",e.replace("%d",t+1))})},(0,p.default)(function(){(0,a.initActivities)(),(0,p.default)(document).on("ps_activitystream_loaded ps_activitystream_append",function(){(0,a.initActivities)()})}),r.observer.addFilter("peepso_postbox_addons",function(t){return t.push(new o),t},10,1),r.observer.addAction("postbox_init",function(t){t.$tabContext.find("#poll-post").remove()},10,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polls":3}],3:[function(t,e,o){(function(t){"use strict";function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(o,"__esModule",{value:!0}),o.initActivities=function(){(0,s.default)(".ps-js-poll-item").each(function(){var t,e=(0,s.default)(this);e.data("init-poll")||(e.data("init-poll",1),(t=e.find(".ps-js-poll-item-option")).on("click",function(){var t=(0,s.default)(this).closest(".ps-js-poll-item"),e=t.find(".ps-js-poll-item-option"),o=t.find(".ps-js-poll-item-submit");e.filter(":checked").length?o.removeAttr("disabled"):o.attr("disabled","disabled")}),t.eq(0).triggerHandler("click"))})},o.getVoteEditorHTML=function(l){return new p.Promise(function(t,e){var o,s,i,n={user_id:r.currentuserid,poll_id:l};(o=p.default.postJson("pollsajax.change_vote",n).ret).done(function(t){s=t.success&&t.data&&t.data.html,i=!s&&t.errors}),o.always(function(){s?t(s):e(i)})})},o.submitVote=function(t,e,o){return new p.Promise(function(t,e){})},o.removeVote=function(t,e){return new p.Promise(function(t,e){})};var e,s=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},p=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==l(t)&&"function"!=typeof t)return{default:t};var e=a();if(e&&e.has(t))return e.get(t);var o={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=s?Object.getOwnPropertyDescriptor(t,i):null;n&&(n.get||n.set)?Object.defineProperty(o,i,n):o[i]=t[i]}o.default=t,e&&e.set(t,o);return o}("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),r="undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null;function a(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return a=function(){return t},t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);