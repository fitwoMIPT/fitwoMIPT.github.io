!function(t,o){function i(t){this.create(t)}var p,d;o.PhotoAlbumDialog=(p=t,(d=o).npm.objectAssign(i.prototype,d.npm.EventEmitter.prototype,{template:psdata_photos_albumdialog.template,album_url:psdata_photos_albumdialog.album_url,create:function(t){var o="ps-js-dialog-create-album",i=_.uniqueId(o+"-");this.user_id=t||peepsodata.userid,this.$el=p(this.template).addClass(o).attr("id",i),this.$submit=this.$el.find(".ps-js-submit"),this.$loading=this.$el.find(".ps-js-loading"),this.$container=this.$el.find(".ps-js-photos-container"),this.$upload=this.$el.find(".ps-js-photos-upload"),this.$el.on("click",".ps-js-photos-upload-button",p.proxy(this.onUpload,this)),this.$el.on("click",".ps-js-cancel",p.proxy(this.onClose,this)),this.$el.on("click",".ps-js-submit",p.proxy(this.onSubmit,this)),this.$el.appendTo(document.body),this.dropzone=new d.PhotoDropzone(this.$el.find(".ps-js-photos-container")),this.dropzone.on("photo_added",p.proxy(this.onPhotoAdded,this)),this.dropzone.on("photo_upload_start",p.proxy(this.onPhotoUploadStart,this)),this.dropzone.on("photo_upload_done",p.proxy(this.onPhotoUploadDone,this)),this.dropzone.on("photo_empty",p.proxy(this.onPhotoEmpty,this)),d.observer.applyFilters("photo_create_album",{popup:this.$el})},onUpload:function(){this.dropzone.triggerUpload()},onPhotoAdded:function(){this.$upload.hide(),this.$container.show()},onPhotoUploadStart:function(){this.$submit.attr("disabled","disabled")},onPhotoUploadDone:function(t){t<=0&&this.$submit.removeAttr("disabled")},onPhotoEmpty:function(){this.$container.hide(),this.$upload.show()},onClose:function(t){t.preventDefault(),t.stopPropagation(),this.dropzone.destroy(),this.$el.remove()},onSubmit:function(){var t=p.trim(this.$el.find("[name=album_name]").val()),o=p.trim(this.$el.find("[name=album_desc]").val()),i=this.dropzone.getPhotos(),e=!1;if(t.length?this.$el.find(".ps-js-error-name").hide():(this.$el.find(".ps-js-error-name").show(),e=!0),1<=i.length?this.$el.find(".ps-js-error-photo").hide():(this.$el.find(".ps-js-error-photo").show(),e=!0),!e){var s={user_id:this.user_id,name:t,description:o,privacy:this.$el.find("[name=album_privacy]").val(),type:"album",photo:i,_wpnonce:this.$el.find("[name=_wpnonce]").val(),_wp_http_referer:this.$el.find("[name=_wp_http_referer]").val()};s=d.observer.applyFilters("photos_create_album_req",s);var n=this.$el.find("[name=album_location]"),a=n.data("location"),h=n.data("latitude"),l=n.data("longitude");a&&h&&l&&(s["location[name]"]=a,s["location[latitude]"]=h,s["location[longitude]"]=l),this.$submit.attr("disabled","disabled"),this.$loading.show(),d.postJson("photosajax.create_album",s,p.proxy(function(t){if(this.$loading.hide(),this.$submit.removeAttr("disabled"),t.success){this.$el.remove();var o=this.album_url+"/"+t.data.album_id;window.location.href=o}},this))}}}),i)}(jQuery,peepso);