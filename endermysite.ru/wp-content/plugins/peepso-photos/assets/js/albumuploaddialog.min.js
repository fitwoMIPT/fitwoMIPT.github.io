!function(o,t){t.PhotoAlbumUploadDialog=function(e,n){function o(o,t){this.create(o,t)}return n.npm.objectAssign(o.prototype,n.npm.EventEmitter.prototype,{template:psdata_photos_albumuploaddialog.template,create:function(o,t){var i="ps-js-dialog-create-album",s=_.uniqueId(i+"-");this.user_id=o||peepsodata.userid,this.album_id=t,this.$el=e(this.template).addClass(i).attr("id",s),this.$submit=this.$el.find(".ps-js-submit"),this.$loading=this.$el.find(".ps-js-loading"),this.$container=this.$el.find(".ps-js-photos-container"),this.$upload=this.$el.find(".ps-js-photos-upload"),this.$el.on("click",".ps-js-photos-upload-button",e.proxy(this.onUpload,this)),this.$el.on("click",".ps-js-cancel",e.proxy(this.onClose,this)),this.$el.on("click",".ps-js-submit",e.proxy(this.onSubmit,this)),this.$el.appendTo(document.body),this.dropzone=new n.PhotoDropzone(this.$el.find(".ps-js-photos-container")),this.dropzone.on("photo_added",e.proxy(this.onPhotoAdded,this)),this.dropzone.on("photo_upload_start",e.proxy(this.onPhotoUploadStart,this)),this.dropzone.on("photo_upload_done",e.proxy(this.onPhotoUploadDone,this)),this.dropzone.on("photo_empty",e.proxy(this.onPhotoEmpty,this))},onUpload:function(){this.dropzone.triggerUpload()},onPhotoAdded:function(){this.$upload.hide(),this.$container.show()},onPhotoUploadStart:function(){this.$submit.attr("disabled","disabled")},onPhotoUploadDone:function(o){o<=0&&this.$submit.removeAttr("disabled")},onPhotoEmpty:function(){this.$container.hide(),this.$upload.show()},onClose:function(o){o.preventDefault(),o.stopPropagation(),this.dropzone.destroy(),this.$el.remove()},onSubmit:function(){var o=this.dropzone.getPhotos(),t=!1;if(1<=o.length?this.$el.find(".ps-js-error-photo").hide():(this.$el.find(".ps-js-error-photo").show(),t=!0),!t){var i={user_id:this.user_id,album_id:this.album_id,type:"photo",photo:o,_wpnonce:this.$el.find("[name=_wpnonce]").val(),_wp_http_referer:this.$el.find("[name=_wp_http_referer]").val()};i=n.observer.applyFilters("photos_add_photos_to_album_req",i),this.$submit.attr("disabled","disabled"),this.$loading.show(),n.postJson("photosajax.add_photos_to_album",i,e.proxy(function(o){this.$loading.hide(),this.$submit.removeAttr("disabled"),o.success&&(this.$el.remove(),window.location.reload())},this))}}}),o}(o,t)}(jQuery,peepso);