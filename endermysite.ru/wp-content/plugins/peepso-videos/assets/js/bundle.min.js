!function r(s,a,u){function d(e,t){if(!a[e]){if(!s[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(l)return l(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[e]={exports:{}};s[e][0].call(i.exports,function(t){return d(s[e][1][t]||t)},i,i.exports,r,s,a,u)}return a[e].exports}for(var l="function"==typeof require&&require,t=0;t<u.length;t++)d(u[t]);return d}({1:[function(s,t,e){(function(t){"use strict";var u=n("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),e=n("undefined"!=typeof window?window._:void 0!==t?t._:null),o="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null;function n(t){return t&&t.__esModule?t:{default:t}}var d="probably"===(0,s("./video").supportsType)("webm");(0,u.default)(document).on("ps_activitystream_loaded",e.default.throttle(function(){(0,u.default)(".ps-js-activity").not("[data-video-init]").each(function(){var t=(0,u.default)(this).attr("data-video-init","").find(".ps-js-video");t.length&&function(e){var t,o=e.find(".ps-video-thumbnail"),n=o.find(".ps-video-play"),i=o.find("img"),r=i.attr("src"),s=i.data("animated"),a=i.data("animated-webm");o.on("mouseenter",function(){a&&d?t?(i.hide(),t.show(),t.get(0).play()):(t=(0,u.default)('<video src="'.concat(a,'" />'))).get(0).addEventListener("loadeddata",function(){i.hide(),t.insertAfter(i),t.show(),t.get(0).play()}):s&&i.attr("src",s)}).on("mouseleave",function(){a&&d?t&&(t.hide(),t.get(0).pause(),i.show()):s&&i.attr("src",r)}),n.on("click",function(){var t=e.children("script").text();e.html(t)})}(t)})},3e3));var i=navigator.userAgent,r=-1<i.indexOf("Safari")&&-1===i.indexOf("Chrome");(o.browser.isIOS()||r)&&o.observer.addFilter("peepso_activity",function(t){return t.each(function(){var t=(0,u.default)(this).find("audio.wp-audio-shortcode");if(t.length){var e=t.find("source");e.length&&(t.attr("src",e.attr("src")),e.remove())}})},10,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./video":17}],2:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n,i=(n=t("eventemitter3"))&&n.__esModule?n:{default:n};function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=function(){function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=a(this,u(o).call(this))).source=t,e.data=null,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}(o,i.default),function(t,e,o){e&&s(t.prototype,e),o&&s(t,o)}(o,[{key:"fetch",value:function(){throw new Error("Must be implemented by subclass!")}},{key:"fetchAbort",value:function(){throw new Error("Must be implemented by subclass!")}},{key:"getHTML",value:function(){var t=this;return new Promise(function(e,o){t.fetch().then(function(t){e(t.html)}).catch(function(t){o(t)})})}},{key:"getData",value:function(){var t=this;return new Promise(function(e,o){t.fetch().then(function(t){e(t)}).catch(function(t){o(t)})})}}]),o}();o.default=l},{eventemitter3:19}],3:[function(l,t,p){(function(t){"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var i=o("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),e=o(l("./abstract"));function o(t){return t&&t.__esModule?t:{default:t}}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var d=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,a(t).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(t,e.default),function(t,e,o){e&&r(t.prototype,e),o&&r(t,o)}(t,[{key:"fetch",value:function(){var n=this;return new Promise(function(e,o){if(n.data)e(n.data);else{var t={url:n.source,accepted_type:"audio"};n.xhr=i.default.postJson("videosajax.get_preview",t,function(t){t.success?(n.data=t.data,e(n.data)):o(t&&t.errors&&t.errors[0])}).ret}})}},{key:"fetchAbort",value:function(){this.xhr&&(this.xhr.abort(),this.xhr=void 0)}}]),t}();p.default=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./abstract":2}],4:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n,i=(n=t("./embed"))&&n.__esModule?n:{default:n};function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var d=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,a(t).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(t,i.default),t}();o.default=d},{"./embed":3}],5:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=r(t("./abstract")),i=r(t("../uploader"));function r(t){return t&&t.__esModule?t:{default:t}}function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function d(t){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var p=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,d(t).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(t,n.default),function(t,e,o){e&&a(t.prototype,e),o&&a(t,o)}(t,[{key:"fetch",value:function(){var n=this;return new Promise(function(e,o){n.data?e(n.data):n.validate().then(function(){n.upload().then(function(t){n.data=_.extend({},t,{html:'<iframe src="'.concat(t.link,'embed" />')}),e(n.data)}).catch(function(t){o(t)})}).catch(function(t){o(t)})})}},{key:"validate",value:function(){var i=this;return new Promise(function(e,o){var t=i.source.files[0],n={type:t.type,size:parseInt(t.size)};peepso.postJson("videosajax.validate_video_upload",n,function(t){t&&t.success?e():o(t&&t.errors&&t.errors[0])})})}},{key:"upload",value:function(){var n=this;return new Promise(function(e,o){var t=new i.default(n.source);t.on("progress",function(t){n.emit("progress",t)}),t.upload().then(function(t){e(t)}).catch(function(t){o(t)})})}}]),t}();o.default=p},{"../uploader":12,"./abstract":2}],6:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.supportsType=o.default=void 0;var n=s(t("eventemitter3")),i=s(t("./file")),r=s(t("./embed"));s(t("./facebook"));function s(t){return t&&t.__esModule?t:{default:t}}function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function u(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function d(t,e){return!e||"object"!==a(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function p(t,e){return(p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f,c=function(){function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=d(this,l(o).call(this))).source=t,e.object=null,"object"===a(t)&&t.nodeType?(e.object=new i.default(t),e.object.on("progress",function(t){e.emit("progress",t)})):"string"==typeof t&&""!==t&&(e.object=new r.default(t)),e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&p(t,e)}(o,n.default),function(t,e,o){e&&u(t.prototype,e),o&&u(t,o)}(o,[{key:"fetchAbort",value:function(){return this.object.fetchAbort()}},{key:"getHTML",value:function(){return this.object.getHTML()}},{key:"getData",value:function(){return this.object.getData()}}]),o}();o.default=c;o.supportsType=function(t){return(f=f||document.createElement("video"))&&"function"==typeof f.canPlayType?f.canPlayType({ogg:'video/ogg; codecs="theora"',h264:'video/mp4; codecs="avc1.42E01E"',webm:'video/webm; codecs="vp8, vorbis"',vp9:'video/webm; codecs="vp9"',hls:'application/x-mpegURL; codecs="avc1.42E01E"'}[t]||t):""}},{"./embed":3,"./facebook":4,"./file":5,eventemitter3:19}],7:[function(t,e,b){(function(t){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(b,"__esModule",{value:!0}),b.default=void 0;var e,d=(e="undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null)&&e.__esModule?e:{default:e},n=o("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),r=o("undefined"!=typeof window?window.peepsodata:void 0!==t?t.peepsodata:null);function a(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return a=function(){return t},t}function o(t){if(t&&t.__esModule)return t;if(null===t||"object"!==s(t)&&"function"!=typeof t)return{default:t};var e=a();if(e&&e.has(t))return e.get(t);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=n?Object.getOwnPropertyDescriptor(t,i):null;r&&(r.get||r.set)?Object.defineProperty(o,i,r):o[i]=t[i]}return o.default=t,e&&e.set(t,o),o}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function p(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t}function u(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var f=function(){function u(){l(this,u)}return p(u,null,[{key:"create",value:function(){var t=u.$outer,e=u.$inner;return t||((e=u.$inner=(0,d.default)("<div />").append(r.media.templateCard)).css({position:"absolute"}),(t=u.$outer=(0,d.default)("<div />").css({display:"none",height:1,overflow:"visible",position:"absolute",width:1,zIndex:100001})).on("mouseenter",function(t){t.stopPropagation(),u.show()}),t.on("mouseleave",function(t){t.stopPropagation(),u.hide()}),t.append(e).appendTo(document.body)),t}},{key:"show",value:function(t,e){clearTimeout(u.hideTimer);var o=u.create(),n=u.$inner;if("loading"===t?o.find(".ps-js-loading").show():t&&(o.find(".ps-js-loading").hide(),o.find(".ps-js-cover").css({backgroundImage:"url(".concat(encodeURI(t.cover),")")}),t.artist?o.find(".ps-js-artist").html(t.artist).show():o.find(".ps-js-artist").hide(),t.album?o.find(".ps-js-album").html(t.album).show():o.find(".ps-js-album").hide()),o.show(),e&&e.currentTarget&&e.clientX){var i=(0,d.default)(e.currentTarget),r=i.offset(),s=window.innerWidth<=480;n.css({top:"",left:0,bottom:0,right:s?0:""}),o.css({top:r.top-o.height(),left:s?0:e.clientX,right:s?0:"",width:s?"":1});var a=n.get(0).getBoundingClientRect();a.top<0&&(o.css({top:r.top+i.height()}),n.css({bottom:"",top:0})),s||a.right>(window.innerWidth||document.documentElement.clientWidth)&&n.css({left:"",right:0})}}},{key:"hide",value:function(){var t=u.$outer;t&&(u.hideTimer=setTimeout(function(){t.hide()},200))}}]),u}();u(f,"$outer",void 0),u(f,"$inner",void 0),u(f,"hideTimer",void 0);var c=function(){function i(t,e){var o=this;l(this,i),u(this,"$elem",void 0),u(this,"opts",void 0),u(this,"showTimer",void 0),this.$elem=(0,d.default)(t),this.opts=e,this.$elem.on("mouseenter",function(t){t.stopPropagation(),o.show(t)}),this.$elem.on("mouseleave",function(t){t.stopPropagation(),o.hide()}),n.default.isTouch()&&this.$elem.on("click",function(t){t.preventDefault(),t.stopPropagation()})}return p(i,[{key:"getData",value:function(){var t=this;return new n.Promise(function(e){var o=t.opts.artist+":"+t.opts.album,n=i.cache[o];n?e(n):d.default.post(r.default.ajaxurl,{action:"peepso_audio_album_info",artist:t.opts.artist,album:t.opts.album},function(t){n=i.cache[o]=t,e(n)},"json")})}},{key:"show",value:function(o){var n=this;this.showTimer=setTimeout(function(){var e=setTimeout(function(){f.show("loading",o)},500);n.getData().then(function(t){clearTimeout(e),n.showTimer&&f.show(t,o)})},300)}},{key:"hide",value:function(){clearTimeout(this.showTimer),this.showTimer=null,f.hide()}}]),i}();u(c,"cache",{});var h=c;b.default=h,(0,d.default)(function(){var t=n.default.isTouch()?"touchstart":"mouseenter";(0,d.default)(document).on(t,"[data-artist][data-album]",function(t){var e=(0,d.default)(t.currentTarget);if(!e.data("ps-mediacard")){var o,n=e.data("artist"),i=e.data("album");n&&i?(o=new c(e[0],{artist:n,album:i}),e.data("ps-mediacard",o),o.show(t)):e.data("ps-mediacard","do_not_trigger")}})})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(r,t,e){(function(t){"use strict";var e="undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null,o=(i(r("./videos")),i(r("./page-videos")),i(r("./postbox"))),n=i(r("./postbox-audio"));function i(t){return t&&t.__esModule?t:{default:t}}r("./activitystream"),r("./card"),e.observer.addFilter("peepso_postbox_addons",function(t){var e={init:function(){},set_postbox:function(t){new o.default(t),new n.default(t)}};return t.push(e),t},10,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./activitystream":1,"./card":7,"./page-videos":9,"./postbox":11,"./postbox-audio":10,"./videos":18}],9:[function(t,e,o){"use strict";new(function(o){function t(){t.super_.apply(this,arguments);o(o.proxy(this.init_page,this))}return peepso.npm.inherits(t,PsPageAutoload),peepso.npm.objectAssign(t.prototype,{init_page:function(){this._search_$sortby=o(".ps-js-videos-sortby").on("change",o.proxy(this._filter,this)),this._search_$sortby.length&&this._search_$sortby.trigger("change"),peepso.observer.addAction("peepso_delete_post",function(t){o(".ps-js-video").filter('[data-post-id="'+t+'"]').remove()},10,1)},_search_url:"videosajax.get_user_videos",_search_params:{uid:peepsodata.currentuserid,user_id:peepsodata.userid,sort:void 0,limit:3,page:1},_search_render_html:function(t){return t.videos||""},_search_get_items:function(){return this._search_$ct.children(".ps-video-wrapper")},_fetch:function(t){return o.Deferred(o.proxy(function(e){t=peepso.observer.applyFilters("peepso_list_videos",t),t=o.extend({},t),_.isUndefined(t.limit)||(t.limit*=2),this._fetch_xhr&&this._fetch_xhr.abort(),this._fetch_xhr=peepso.getJson(this._search_url,t,o.proxy(function(t){t.success?e.resolveWith(this,[t.data]):e.rejectWith(this,[t.errors])},this))},this))},_filter:function(){var t=this._search_$sortby.val();this._fetch_xhr&&this._fetch_xhr.abort(),this._search_params.sort=t||void 0,this._search_params.page=1,this._search()}}),t}(jQuery))(".ps-js-videos")},{}],10:[function(r,t,p){(function(t){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var o=e("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),a=e("undefined"!=typeof window?window._:void 0!==t?t._:null),u=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==s(t)&&"function"!=typeof t)return{default:t};var e=l();if(e&&e.has(t))return e.get(t);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=n?Object.getOwnPropertyDescriptor(t,i):null;r&&(r.get||r.set)?Object.defineProperty(o,i,r):o[i]=t[i]}o.default=t,e&&e.set(t,o);return o}("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),d=e(r("./audio"));function l(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return l=function(){return t},t}function e(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=function(){function e(t){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=window.peepsoaudiodata||{},this.$postbox=t,this.$postboxTab=this.$postbox.$posttabs,this.$postboxStatusTextarea=this.$postbox.$textarea,this.$postboxStatus=this.$postboxStatusTextarea.closest(".ps-postbox-status"),this.$postboxAudio=this.$postbox.find(".ps-postbox-tabs [data-tab-id=audio]"),this.$postboxAudioShortcut=this.$postbox.find("#audio-post"),this.$postboxTab.on("peepso_posttabs_show-audio",function(){n.show()}),this.$postboxTab.on("peepso_posttabs_cancel-audio",function(){n.cancel()}),this.$postboxTab.on("peepso_posttabs_submit-audio",function(){n.post()}),this.$postboxAudioShortcut.on("click",function(){n.$postboxTab.find("[data-tab=audio]").click()}),u.observer.addAction("postbox_type_set",o.default.proxy(function(t,e){t===this.$postbox&&"audio"===e&&this.$postboxAudioShortcut.trigger("click")},this),10,2),this.$embed=this.$postbox.find(".ps-js-audio-embed"),this.$embedUrl=this.$embed.find(".ps-js-url"),this.$embedLoading=this.$embed.find(".ps-js-loading"),this.$embedUrl.on("input",a.default.debounce(function(t){return n.embed(t.target.value)},2e3)),this.$embedUrl.on("paste",function(t){return a.default.defer(function(){return n.embed(t.target.value)})}),this.$embedUrl.on("blur",function(t){n.$uploadBtn.off("click"),a.default.defer(function(){return n.$uploadBtn.on("click",function(){return n.onUploadClick()})}),n.embed(t.target.value)}),this.$upload=this.$postbox.find(".ps-js-audio-upload"),this.$uploadBtn=this.$upload.find(".ps-js-btn"),this.$uploadForm=this.$upload.find(".ps-js-form"),this.$uploadTitle=this.$upload.find(".ps-js-title"),this.$uploadArtist=this.$upload.find(".ps-js-artist"),this.$uploadAlbum=this.$upload.find(".ps-js-album"),this.$uploadProgress=this.$upload.find(".ps-js-progress"),this.$uploadDone=this.$upload.find(".ps-js-done"),this.$uploadFailed=this.$upload.find(".ps-js-failed"),this.$uploadSuccess=this.$upload.find(".ps-js-success"),this.$uploadBtn.on("click",function(){return n.onUploadClick()}),this.$separator=this.$postbox.find(".ps-js-audio-separator"),this.$preview=this.$postbox.find(".ps-js-audio-preview"),this.mode=null,this.data=null,this.$uploadTitle.on("input",a.default.throttle(function(){n.$postbox.on_change()},500)),u.observer.addFilter("peepso_postbox_can_submit",function(t,e){if(n.$postbox===e&&"audio"===n.$postboxTab.current_tab_id)if("embed"===n.mode)t.hard.push(!!n.data);else if("upload"===n.mode){var o=n.$uploadTitle.val().trim();t.hard.push(!(!n.data||!o))}return t},10,2),u.observer.addFilter("peepso_postbox_onsave",function(t,e){return n.$postbox===e&&"audio"===n.$postboxTab.current_tab_id&&("upload"!==n.mode||n.data&&n.data.is_audio||(t=function(){n.uploadShowNotice=!0})),t},10,2),this.uploadInit(),this.uploadInitialized=!0}return function(t,e,o){e&&n(t.prototype,e),o&&n(t,o)}(e,[{key:"show",value:function(){this.mode=null,this.$postboxAudioShortcut.addClass("active"),this.$postboxAudio.show(),this.$embed.show(),this.$separator.show(),this.$upload.show(),this.$uploadBtn.show(),this.$uploadForm.hide(),this.$uploadSuccess.hide(),this.$preview.hide(),+this.config.upload_enable?this.$postboxStatus.hide():(this.$postboxStatus.show(),this.mode="embed"),this.uploadShowNotice&&(delete this.uploadShowNotice,this.showUpload(),this.$uploadForm.hide(),this.$uploadSuccess.show(),this.$postboxStatus.hide())}},{key:"showEmbed",value:function(){this.mode="embed",this.$postboxStatus.show(),this.$embed.show(),this.$separator.hide(),this.$upload.hide(),this.$preview.show()}},{key:"showUpload",value:function(){this.mode="upload",this.$postboxStatus.show(),this.$embed.hide(),this.$separator.hide(),this.$upload.show(),this.$uploadTitle.val(""),this.$uploadArtist.val(""),this.$uploadAlbum.val(""),this.$uploadBtn.hide(),this.$uploadForm.show(),this.$uploadProgress.show(),this.$uploadDone.hide(),this.$uploadFailed.hide(),this.$preview.show()}},{key:"cancel",value:function(){this.mode=null,this.data=null,this.$postboxAudioShortcut.removeClass("active"),this.$embedUrl.val(this._embedUrl=""),this.$preview.empty(),this.$postbox.on_change()}},{key:"post",value:function(){var t="postbox_req_"+this.$postbox.guid;u.observer.addFilter(t,this.postSetRequest,10,1,this),this.$postbox.save_post(),u.observer.removeFilter(t,this.postSetRequest,10)}},{key:"postSetRequest",value:function(t){return"embed"===this.mode?a.default.extend(t,{type:"audio",url:this.data.url}):"upload"===this.mode&&a.default.extend(t,{type:"audio",audio:this.data.file,audio_title:this.$uploadTitle.val().trim(),audio_artist:this.$uploadArtist.val().trim(),audio_album:this.$uploadAlbum.val().trim()}),t}},{key:"embed",value:function(t){var e=this,o=0<arguments.length&&void 0!==t?t:"";(o=o.trim()).match(/^https?:\/\//i)&&o!==this._embedUrl&&(this._embedUrl=o,this.audio&&this.audio.fetchAbort(),this.showEmbed(),this.$embedLoading.show(),this.audio=new d.default(o),this.audio.getHTML().then(function(t){e.$preview.html(t),e.audio.getData().then(function(t){e.data=t,e.$postbox.on_change()})}).catch(function(t){e.$embedUrl.val(e._embedUrl=""),window.psmessage.show("",t)}).finally(function(){e.$embedLoading.hide()}))}},{key:"onUploadClick",value:function(){this.uploadInitialized||(this.uploadInit(),this.uploadInitialized=!0);try{this.$uploadFile[0].value=null}catch(t){}this.$uploadFile.click()}},{key:"uploadInit",value:function(){var r=this;this.$uploadFile||(this.$uploadFile=this.$upload.find(".ps-js-file"),this.$uploadFile.psFileupload({replaceFileInput:!1,add:function(t){var e=t.target,n=r.$uploadProgress.find(".ps-videos__postbox-progressbar"),i=r.$uploadProgress.find(".ps-js-percent");r.showUpload(),i.html(""),n.css({transition:"",width:1}),r.beforeUnloadHandler||(r.beforeUnloadHandler=function(){return!0},u.observer.addFilter("beforeunload",r.beforeUnloadHandler)),r.audio=new d.default(e),r.audio.on("progress",a.default.throttle(function(t){var e=+t,o=Math.min(100,+t);0<e&&e<100&&(e=e.toFixed(2)),i.html("".concat(e,"%")),n.css({transition:"width 1s",width:"".concat(o,"%")}),100===o&&setTimeout(function(){r.$uploadProgress.hide()},1500)},u.browser.isIOS()?1500:250)),r.audio.getHTML().then(function(){r.$uploadDone.show(),r.audio.getData().then(function(t){r.beforeUnloadHandler&&(u.observer.removeFilter("beforeunload",r.beforeUnloadHandler),r.beforeUnloadHandler=null),r.data=t,r.$postbox.on_focus(),r.$postbox.on_change()})}).catch(function(t,e){var o=r.$uploadFailed,n=o.find(".ps-js-failed-message");e=t.errors&&t.errors.join(" ")||"Error.",n.html(e),o.show()})}}))}}]),e}();p.default=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./audio":6}],11:[function(r,t,p){(function(t){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var o=e("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),a=e("undefined"!=typeof window?window._:void 0!==t?t._:null),u=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==s(t)&&"function"!=typeof t)return{default:t};var e=l();if(e&&e.has(t))return e.get(t);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=n?Object.getOwnPropertyDescriptor(t,i):null;r&&(r.get||r.set)?Object.defineProperty(o,i,r):o[i]=t[i]}o.default=t,e&&e.set(t,o);return o}("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),d=e(r("./video"));function l(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return l=function(){return t},t}function e(t){return t&&t.__esModule?t:{default:t}}function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=function(){function e(t){var n=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=window.peepsovideosdata||{},this.$postbox=t,this.$postboxTab=this.$postbox.$posttabs,this.$postboxStatusTextarea=this.$postbox.$textarea,this.$postboxStatus=this.$postboxStatusTextarea.closest(".ps-postbox-status"),this.$postboxVideo=this.$postbox.find(".ps-postbox-tabs [data-tab-id=videos]"),this.$postboxVideoShortcut=this.$postbox.find("#video-post"),this.$postboxTab.on("peepso_posttabs_show-videos",function(){n.show()}),this.$postboxTab.on("peepso_posttabs_cancel-videos",function(){n.cancel()}),this.$postboxTab.on("peepso_posttabs_submit-videos",function(){n.post()}),this.$postboxVideoShortcut.on("click",function(){n.$postboxTab.find("[data-tab=videos]").click()}),u.observer.addAction("postbox_type_set",o.default.proxy(function(t,e){t===this.$postbox&&"videos"===e&&this.$postboxVideoShortcut.trigger("click")},this),10,2),this.$embed=this.$postbox.find(".ps-js-video-embed"),this.$embedUrl=this.$embed.find(".ps-js-url"),this.$embedLoading=this.$embed.find(".ps-js-loading"),this.$embedUrl.on("input",a.default.debounce(function(t){return n.embed(t.target.value)},2e3)),this.$embedUrl.on("paste",function(t){return a.default.defer(function(){return n.embed(t.target.value)})}),this.$embedUrl.on("blur",function(t){n.$uploadBtn.off("click"),a.default.defer(function(){return n.$uploadBtn.on("click",function(){return n.onUploadClick()})}),n.embed(t.target.value)}),this.$upload=this.$postbox.find(".ps-js-video-upload"),this.$uploadBtn=this.$upload.find(".ps-js-btn"),this.$uploadForm=this.$upload.find(".ps-js-form"),this.$uploadTitle=this.$upload.find(".ps-js-title"),this.$uploadProgress=this.$upload.find(".ps-js-progress"),this.$uploadDone=this.$upload.find(".ps-js-done"),this.$uploadFailed=this.$upload.find(".ps-js-failed"),this.$uploadSuccess=this.$upload.find(".ps-js-success"),this.$uploadBtn.on("click",function(){return n.onUploadClick()}),this.$separator=this.$postbox.find(".ps-js-video-separator"),this.$preview=this.$postbox.find(".ps-js-video-preview"),this.mode=null,this.data=null,this.$uploadTitle.on("input",a.default.throttle(function(){n.$postbox.on_change()},500)),u.observer.addFilter("peepso_postbox_can_submit",function(t,e){if(n.$postbox===e&&"videos"===n.$postboxTab.current_tab_id)if("embed"===n.mode)t.hard.push(!!n.data);else if("upload"===n.mode){var o=n.$uploadTitle.val().trim();t.hard.push(!(!n.data||!o))}return t},10,2),u.observer.addFilter("peepso_postbox_onsave",function(t,e){return n.$postbox===e&&"videos"===n.$postboxTab.current_tab_id&&("upload"!==n.mode||n.data&&n.data.is_audio||(t=function(){n.uploadShowNotice=!0})),t},10,2),this.uploadInit(),this.uploadInitialized=!0}return function(t,e,o){e&&n(t.prototype,e),o&&n(t,o)}(e,[{key:"show",value:function(){this.mode=null,this.$postboxVideoShortcut.addClass("active"),this.$postboxVideo.show(),this.$embed.show(),this.$separator.show(),this.$upload.show(),this.$uploadBtn.show(),this.$uploadForm.hide(),this.$uploadSuccess.hide(),this.$preview.hide(),+this.config.upload_enable?this.$postboxStatus.hide():(this.$postboxStatus.show(),this.mode="embed"),this.uploadShowNotice&&(delete this.uploadShowNotice,this.showUpload(),this.$uploadForm.hide(),this.$uploadSuccess.show(),this.$postboxStatus.hide())}},{key:"showEmbed",value:function(){this.mode="embed",this.$postboxStatus.show(),this.$embed.show(),this.$separator.hide(),this.$upload.hide(),this.$preview.show()}},{key:"showUpload",value:function(){this.mode="upload",this.$postboxStatus.show(),this.$embed.hide(),this.$separator.hide(),this.$upload.show(),this.$uploadTitle.val(""),this.$uploadBtn.hide(),this.$uploadForm.show(),this.$uploadProgress.show(),this.$uploadDone.hide(),this.$uploadFailed.hide(),this.$preview.show()}},{key:"cancel",value:function(){this.mode=null,this.data=null,this.$postboxVideoShortcut.removeClass("active"),this.$embedUrl.val(this._embedUrl=""),this.$preview.empty(),this.$postbox.on_change()}},{key:"post",value:function(){var t="postbox_req_"+this.$postbox.guid;u.observer.addFilter(t,this.postSetRequest,10,1,this),this.$postbox.save_post(),u.observer.removeFilter(t,this.postSetRequest,10)}},{key:"postSetRequest",value:function(t){return"embed"===this.mode?a.default.extend(t,{type:"video",url:this.data.url}):"upload"===this.mode&&a.default.extend(t,{type:"video",video:this.data.file,video_title:this.$uploadTitle.val().trim()}),t}},{key:"embed",value:function(t){var e=this,o=0<arguments.length&&void 0!==t?t:"";(o=o.trim()).match(/^https?:\/\//i)&&o!==this._embedUrl&&(this._embedUrl=o,this.video&&this.video.fetchAbort(),this.showEmbed(),this.$embedLoading.show(),this.video=new d.default(o),this.video.getHTML().then(function(t){e.$preview.html(t),e.video.getData().then(function(t){e.data=t,e.$postbox.on_change()})}).catch(function(t){e.$embedUrl.val(e._embedUrl=""),window.psmessage.show("",t)}).finally(function(){e.$embedLoading.hide()}))}},{key:"onUploadClick",value:function(){this.uploadInitialized||(this.uploadInit(),this.uploadInitialized=!0);try{this.$uploadFile[0].value=null}catch(t){}this.$uploadFile.click()}},{key:"uploadInit",value:function(){var r=this;this.$uploadFile||(this.$uploadFile=this.$upload.find(".ps-js-file"),this.$uploadFile.psFileupload({replaceFileInput:!1,add:function(t){var e=t.target,n=r.$uploadProgress.find(".ps-videos__postbox-progressbar"),i=r.$uploadProgress.find(".ps-js-percent");r.showUpload(),i.html(""),n.css({transition:"",width:1}),r.beforeUnloadHandler||(r.beforeUnloadHandler=function(){return!0},u.observer.addFilter("beforeunload",r.beforeUnloadHandler)),r.video=new d.default(e),r.video.on("progress",a.default.throttle(function(t){var e=+t,o=Math.min(100,+t);0<e&&e<100&&(e=e.toFixed(2)),i.html("".concat(e,"%")),n.css({transition:"width 1s",width:"".concat(o,"%")}),100===o&&setTimeout(function(){r.$uploadProgress.hide()},1500)},u.browser.isIOS()?1500:250)),r.video.getHTML().then(function(){r.$uploadDone.show(),r.video.getData().then(function(t){r.beforeUnloadHandler&&(u.observer.removeFilter("beforeunload",r.beforeUnloadHandler),r.beforeUnloadHandler=null),r.data=t,r.$postbox.on_focus(),r.$postbox.on_change()})}).catch(function(t,e){var o=r.$uploadFailed,n=o.find(".ps-js-failed-message");e=t.errors&&t.errors.join(" ")||"Error.",n.html(e),o.show()})}}))}}]),e}();p.default=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./video":17}],12:[function(f,t,c){(function(t){"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=void 0;var i=o("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),e=o(f("eventemitter3"));function o(t){return t&&t.__esModule?t:{default:t}}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var d=peepsovideosdata.upload_url,l=peepsovideosdata.nonce,p=function(){function n(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var o=t.files[0];return(e=s(this,a(n).call(this))).data=new FormData,e.data.append("filedata",o),e.data.append("size",o.size),e.data.append("name",o.name),e.data.append("_wpnonce",l),e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(n,e.default),function(t,e,o){e&&r(t.prototype,e),o&&r(t,o)}(n,[{key:"upload",value:function(){var n=this;return new Promise(function(e,o){i.default.ajax({url:d,data:n.data,processData:!1,contentType:!1,dataType:"json",type:"POST",xhr:function(){var t=null;return t=window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLHTTP"):new window.XMLHttpRequest,t.upload.addEventListener("progress",function(t){if(t.lengthComputable){var e=+(100*t.loaded/t.total).toFixed(2);n.emit("progress",e)}},!1),t}}).done(function(t){t.success?e(t.data):o(t)}).fail(function(t,e){o(e)})})}}]),n}();c.default=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{eventemitter3:19}],13:[function(t,e,o){arguments[4][2][0].apply(o,arguments)},{dup:2,eventemitter3:19}],14:[function(l,t,p){(function(t){"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.default=void 0;var i=o("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),e=o(l("./abstract"));function o(t){return t&&t.__esModule?t:{default:t}}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function s(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var d=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,a(t).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(t,e.default),function(t,e,o){e&&r(t.prototype,e),o&&r(t,o)}(t,[{key:"fetch",value:function(){var n=this;return new Promise(function(e,o){n.data?e(n.data):n.xhr=i.default.postJson("videosajax.get_preview",{url:n.source},function(t){t.success?(n.data=t.data,e(n.data)):o(t&&t.errors&&t.errors[0])}).ret})}},{key:"fetchAbort",value:function(){this.xhr&&(this.xhr.abort(),this.xhr=void 0)}}]),t}();p.default=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./abstract":13}],15:[function(t,e,o){arguments[4][4][0].apply(o,arguments)},{"./embed":14,dup:4}],16:[function(t,e,o){arguments[4][5][0].apply(o,arguments)},{"../uploader":12,"./abstract":13,dup:5}],17:[function(t,e,o){arguments[4][6][0].apply(o,arguments)},{"./embed":14,"./facebook":15,"./file":16,dup:6,eventemitter3:19}],18:[function(o,t,e){(function(t){"use strict";function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var i,a=e("undefined"!=typeof window?window.jQuery:void 0!==t?t.jQuery:null),u=function(t){if(t&&t.__esModule)return t;if(null===t||"object"!==s(t)&&"function"!=typeof t)return{default:t};var e=d();if(e&&e.has(t))return e.get(t);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var r=n?Object.getOwnPropertyDescriptor(t,i):null;r&&(r.get||r.set)?Object.defineProperty(o,i,r):o[i]=t[i]}o.default=t,e&&e.set(t,o);return o}("undefined"!=typeof window?window.peepso:void 0!==t?t.peepso:null),r=e(o("./uploader"));function d(){if("function"!=typeof WeakMap)return null;var t=new WeakMap;return d=function(){return t},t}function e(t){return t&&t.__esModule?t:{default:t}}window.ps_videos=u.default.videos=function(){window.PsVideos=function t(){this._fileList=[];this.show_progress=null;this.queue_filesize=0;this.$url_textarea=null;this.$uploader=null;this.has_valid_url=false;this.preview_request=false;this.save_post=null;this.last_error=null};var t=new PsVideos;return PsVideos.prototype.init=function(){var n=this;u.observer.addFilter("peepso_postbox_can_submit",function(t){return"videos"===n.$postbox.$posttabs.current_tab_id&&t.hard.push(i||!!n.has_valid_url),t},30,1);var t=this.$postbox.$textarea.attr("placeholder");jQuery(this.$postbox.$posttabs).on("peepso_posttabs_show-videos",function(t,e,o){jQuery("#video-post",n.$postbox).hide(),e.show(),void 0!==postbox.$textarea&&postbox.$textarea.attr("placeholder","Say something about this video..."),jQuery(".ps-postbox-status",o.options.container).show()}),this.$url_textarea=jQuery(".ps-videos-url",this.$postbox),this.$uploader=jQuery("[data-tab-id=videos]").find("#ps-upload-container > div").eq(0),this.$postbox.$posttabs.on("peepso_posttabs_submit-videos",function(){i||n.has_valid_url?(u.observer.addFilter("postbox_req_"+n.$postbox.guid,function(t){return n.set_post_filter(t)},10,1),n.$postbox.save_post(),u.observer.removeFilter("postbox_req_"+n.$postbox.guid,function(t){return n.set_post_filter(t)},10,1)):null!==n.last_error&&psmessage.show("",n.last_error).fade_out(psmessage.fade_time)}),this.$postbox.$posttabs.on("peepso_posttabs_cancel-videos",function(){jQuery("#video-post",n.$postbox).show(),n.$postbox.$textarea.attr("placeholder",t),n.on_cancel()}),jQuery("#video-post",this.$postbox).on("click",function(){"videos"!==n.$postbox.$posttabs.current_tab().data("tab")&&(jQuery(n.$postbox.$posttabs).find("[data-tab='videos']").trigger("click"),n.$postbox.$textarea.focus())}),this.$url_textarea.on("change",function(){n.on_url_input(n.$url_textarea.val())}),this.$uploader.on("click",function(){n.browseFile()}),u.observer.addFilter("postbox_req_edit",function(t,e){var o=jQuery(".ps-videos-edit-url",this.$postbox);return 0<o.length&&(t.url=o.val(),t.type="video"),t},10,2),this.save_post=jQuery.proxy(activity.option_savepost,activity),activity.option_savepost=function(t){n.option_savepost(t)}},PsVideos.prototype.on_url_input=function(t){var i=this.$postbox.find(".ps-postbox-videos .ps-postbox-input .ps-postbox-loading"),r=this.$postbox.find(".ps-postbox-videos .ps-postbox-preview"),s=this.$postbox.find(".ps-postbox-action > .ps-button-action.postbox-submit");this.preview_request&&this.preview_request.ret&&this.preview_request.ret.abort(),i.show(),this.preview_request=u.default.postJson("videosajax.get_preview",{url:t},a.default.proxy(function(t){var e,o=/<div[^<]+fb-root[^<]+<[^>]+>/i,n=!1;i.hide(),t.success?(this.has_valid_url=!0,(n=(e=t.data.html).match(o))&&(e=(e=e.replace(o,"")).replace(/<script[^<]+<\/script>/i,"")),r.empty().show().html(e),n&&u.default.util.fbParseXFBML()):(this.has_valid_url=!1,r.hide().empty(),s.hide(),t.errors&&(this.last_error=t.errors[0],psmessage.show("",this.last_error))),this.$postbox.on_change(),this.preview_request=!1},this))},PsVideos.prototype.set_postbox=function(t){this.$postbox=t},PsVideos.prototype.on_cancel=function(){this.preview_request&&(this.preview_request.ret.abort(),jQuery(".ps-postbox-videos .ps-postbox-input .ps-postbox-loading",this.$postbox).hide()),this.has_valid_url=!1,jQuery("#ps-videos-input",this.$postbox).hide(),this.$url_textarea.val(""),i=!1,jQuery(".ps-postbox-videos .ps-postbox-preview",this.$postbox).hide().html(""),this.$postbox.on_change()},PsVideos.prototype.set_post_filter=function(t){return i?t.video_id=i:t.url=this.$url_textarea.val(),t.type="video",console.log(t),t},PsVideos.prototype.play_video=function(t,e){if("vimeo"===(e=e||{}).type)return this.play_vimeo_video(t,e),!1;$player=jQuery("#peepso-video-player-"+jQuery(t).data("post-id")).find("iframe"),jQuery("#peepso-video-player-"+jQuery(t).data("post-id")).fadeIn();var o=jQuery(t).parents(".video-avatar");o.siblings(".video-description").css("display","block");var n,i=jQuery("#peepso-video-player-"+jQuery(t).data("post-id")).parent();i.show(),o.parent().prepend(i),o.fadeOut().remove();var r=$player.width();return $player.width()/$player.height()<$player.parent().width()/$player.parent().height()?(n={width:"100%"},$player.css(n),new_width=$player.width(),$player.css("height",$player.height()*(new_width/r))):n={width:"100%",height:"390"},$player.css(n),!1},PsVideos.prototype.play_vimeo_video=function(t,e){var o=(t=(0,a.default)(t)).closest(".ps-media-video");if(o.length){var n=o.prev(".cstream-attachment");if(n.length){var i=n.find("iframe");i.length||(i=(0,a.default)('<iframe src="https://player.vimeo.com/video/'+e.id+'?autoplay=1" width="500" height="281" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen style="width:100%"></iframe>')).appendTo(n);var r=t.closest(".video-avatar");r.siblings(".video-description").css("display","block"),r.remove(),n.show()}}},PsVideos.prototype.option_savepost=function(e){var o=this,n=jQuery(".ps-js-activity--"+e);if(0<n.length){var t=u.observer.applyFilters("postbox_req_edit",{},jQuery(".cstream-edit textarea",n));void 0!==t.type&&void 0!==t.url&&"video"===t.type?(jQuery(".cstream-edit textarea, .cstream-edit input",n).attr("disabled","disabled"),jQuery(".ps-edit-loading",n).show(),jQuery(".cstream-edit button",n).hide(),u.default.postJson("videosajax.get_preview",{url:t.url},function(t){void 0!==t.errors?(psmessage.show("",t.errors[0]).fade_out(psmessage.fade_time),jQuery(".cstream-edit textarea, .cstream-edit input",n).removeAttr("disabled"),jQuery(".ps-edit-loading",n).hide(),jQuery(".cstream-edit button",n).show()):o.save_post(e)})):this.save_post(e)}else this.save_post(e)},PsVideos.prototype.browseFile=function(){var t,n=this;this.$file||(this.$file=(0,a.default)('<input type="file" name="filedata[]" accept="video/mp4,video/x-m4v,video/*" />'),(t=(0,a.default)("<div />").append(this.$file)).css({position:"absolute",top:0,right:0,width:1,height:1,overflow:"hidden"}),t.insertAfter(this.$uploader),this.$file.on("change",function(t){var e=t.target,o=e.files[0];t.preventDefault(),n.validate(o).then(function(){new r.default(e).upload().then(function(t){i=t.id})}).fail(function(t){psmessage.show("",t[0]).fade_out(psmessage.fade_time)})})),this.$file.click()},PsVideos.prototype.validate=function(o){return a.default.Deferred(function(e){var t={type:o.type,size:parseInt(o.size)};u.default.postJson("videosajax.validate_video_upload",t,function(t){t&&t.success?e.resolve():e.reject(t&&t.errors)})})},t}(),u.observer.addAction("postbox_init",function(t){t.$tabContext.find("#audio-post").remove(),t.$tabContext.find("#video-post").remove()},10,1),u.observer.addAction("peepso_delete_post",function(t){var e=(0,a.default)(".ps-widget--videos").find(".ps-js-video");(e=e.filter('[data-post-id="'+t+'"]')).remove()},10,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./uploader":12}],19:[function(t,e,o){"use strict";var n=Object.prototype.hasOwnProperty,c="~";function i(){}function a(t,e,o){this.fn=t,this.context=e,this.once=o||!1}function r(t,e,o,n,i){if("function"!=typeof o)throw new TypeError("The listener must be a function");var r=new a(o,n||t,i),s=c?c+e:e;return t._events[s]?t._events[s].fn?t._events[s]=[t._events[s],r]:t._events[s].push(r):(t._events[s]=r,t._eventsCount++),t}function d(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(c=!1)),s.prototype.eventNames=function(){var t,e,o=[];if(0===this._eventsCount)return o;for(e in t=this._events)n.call(t,e)&&o.push(c?e.slice(1):e);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},s.prototype.listeners=function(t){var e=c?c+t:t,o=this._events[e];if(!o)return[];if(o.fn)return[o.fn];for(var n=0,i=o.length,r=new Array(i);n<i;n++)r[n]=o[n].fn;return r},s.prototype.listenerCount=function(t){var e=c?c+t:t,o=this._events[e];return o?o.fn?1:o.length:0},s.prototype.emit=function(t,e,o,n,i,r){var s=c?c+t:t;if(!this._events[s])return!1;var a,u,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,o),!0;case 4:return d.fn.call(d.context,e,o,n),!0;case 5:return d.fn.call(d.context,e,o,n,i),!0;case 6:return d.fn.call(d.context,e,o,n,i,r),!0}for(u=1,a=new Array(l-1);u<l;u++)a[u-1]=arguments[u];d.fn.apply(d.context,a)}else{var p,f=d.length;for(u=0;u<f;u++)switch(d[u].once&&this.removeListener(t,d[u].fn,void 0,!0),l){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,e);break;case 3:d[u].fn.call(d[u].context,e,o);break;case 4:d[u].fn.call(d[u].context,e,o,n);break;default:if(!a)for(p=1,a=new Array(l-1);p<l;p++)a[p-1]=arguments[p];d[u].fn.apply(d[u].context,a)}}return!0},s.prototype.on=function(t,e,o){return r(this,t,e,o,!1)},s.prototype.once=function(t,e,o){return r(this,t,e,o,!0)},s.prototype.removeListener=function(t,e,o,n){var i=c?c+t:t;if(!this._events[i])return this;if(!e)return d(this,i),this;var r=this._events[i];if(r.fn)r.fn!==e||n&&!r.once||o&&r.context!==o||d(this,i);else{for(var s=0,a=[],u=r.length;s<u;s++)(r[s].fn!==e||n&&!r[s].once||o&&r[s].context!==o)&&a.push(r[s]);a.length?this._events[i]=1===a.length?a[0]:a:d(this,i)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=c?c+t:t,this._events[e]&&d(this,e)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=c,s.EventEmitter=s,void 0!==e&&(e.exports=s)},{}]},{},[8]);