!function(e,t){var s=function(e){function t(e){this.opts=e||{},this.create()}return peepso.npm.objectAssign(t.prototype,{template:peepsogroupsdata.dialogCreateTemplate,create:function(){this.$el=e(this.template),this.$submit=this.$el.find(".ps-js-submit"),this.$loading=this.$el.find(".ps-js-loading"),this.$el.on("input","[name=group_name]",e.proxy(this.onInput,this)),this.$el.on("input","[name=group_desc]",e.proxy(this.onInput,this)),this.$el.on("click",".ps-js-dropdown--privacy .ps-js-dropdown-menu a",e.proxy(this.onChangePrivacy,this)),this.$el.on("click",".ps-js-cancel",e.proxy(this.onClose,this)),this.$el.on("click",".ps-js-submit",e.proxy(this.onSubmit,this)),this.$el.appendTo(document.body)},onInput:function(t){var s=e(t.currentTarget),i=s.parent().find(".ps-js-limit"),o=+s.data("maxlength"),r=s.val();o&&r.length>o&&(r=r.substr(0,o),s.val(r)),i.html(o-r.length)},onChangePrivacy:function(t){var s=e(t.currentTarget),i=s.closest(".ps-js-dropdown").find(".ps-js-dropdown-toggle");i.find(".dropdown-value span").text(s.find(".ps-dropdown__group-title span").text()),i.find(".dropdown-value [class*=ps-icon]").attr("class",s.find(".ps-dropdown__group-title [class*=ps-icon]").attr("class")),this.$el.find("input[name=group_privacy]").val(s.data("optionValue"))},onClose:function(e){e.preventDefault(),e.stopPropagation(),this.$el.remove()},onSubmit:function(){var t,s=e.trim(this.$el.find("[name=group_name]").val()),i=e.trim(this.$el.find("[name=group_desc]").val()),o=new Array,r=this.$el.find("[name=group_privacy]").val(),n=this.$el.find("[name=_wpnonce]").val();this.$el.find("[name=category_id]:checked").each(function(){o.push(e(this).val())}),t={name:s,description:i,category_id:o,meta:{privacy:r},_wpnonce:n},this.$submit.attr("disabled","disabled"),this.$loading.show(),peepso.postJson("groupajax.create",t,e.proxy(function(e){this.$loading.hide(),this.$submit.removeAttr("disabled"),e.success?e.data&&e.data.redirect&&(window.location=e.data.redirect):e.errors&&e.errors.length&&(error=e.errors[0]||{},error.name?this.$el.find(".ps-js-error-name").html(error.name).show():this.$el.find(".ps-js-error-name").hide(),error.description?this.$el.find(".ps-js-error-desc").html(error.description).show():this.$el.find(".ps-js-error-desc").hide(),error.category_id?this.$el.find(".ps-js-error-category_id").html(error.category_id).show():this.$el.find(".ps-js-error-category_id").hide())},this))}}),t}(jQuery);peepso.groups||(peepso.groups={}),peepso.groups.dlgCreate=function(e){new s(e)}}();